<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>rc.lua.org</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="rc.lua.org"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-05-11 Fri"/>
<meta name="author" content="Rainer M. Krug"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">rc.lua.org</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Old README</a>
<ul>
<li><a href="#sec-1-1">1.1 INSTALL</a></li>
<li><a href="#sec-1-2">1.2 DIRECTORY STRUCTURE</a></li>
<li><a href="#sec-1-3">1.3 PIPELETS</a></li>
<li><a href="#sec-1-4">1.4 DEFAULT KEYBINDINGS</a>
<ul>
<li><a href="#sec-1-4-1">1.4.1 Client keys</a></li>
<li><a href="#sec-1-4-2">1.4.2 Tag keys</a></li>
<li><a href="#sec-1-4-3">1.4.3 Other</a></li>
</ul>
</li>
<li><a href="#sec-1-5">1.5 </a></li>
</ul>
</li>
<li><a href="#sec-2">2 rc.lua</a>
<ul>
<li><a href="#sec-2-1">2.1 Include libraries</a></li>
<li><a href="#sec-2-2">2.2 Debug</a></li>
<li><a href="#sec-2-3">2.3 Run or raise function</a></li>
<li><a href="#sec-2-4">2.4 Execute adjustMonitor</a></li>
<li><a href="#sec-2-5">2.5 Data serialisation helpers</a></li>
<li><a href="#sec-2-6">2.6 Menu helpers</a></li>
<li><a href="#sec-2-7">2.7 Variable definitions</a>
<ul>
<li><a href="#sec-2-7-1">2.7.1 Default modkey</a></li>
<li><a href="#sec-2-7-2">2.7.2 Environment programs</a></li>
<li><a href="#sec-2-7-3">2.7.3 Default modkey</a></li>
<li><a href="#sec-2-7-4">2.7.4 Naughty</a></li>
<li><a href="#sec-2-7-5">2.7.5 Table of layouts</a></li>
<li><a href="#sec-2-7-6">2.7.6 Custom Icons</a></li>
</ul>
</li>
<li><a href="#sec-2-8">2.8 Shifty</a>
<ul>
<li><a href="#sec-2-8-1">2.8.1 Shifty Configured tags</a></li>
<li><a href="#sec-2-8-2">2.8.2 Shifty application matching rules</a></li>
<li><a href="#sec-2-8-3">2.8.3 Shifty default tag creation rules</a></li>
</ul>
</li>
<li><a href="#sec-2-9">2.9 Wibox</a>
<ul>
<li><a href="#sec-2-9-1">2.9.1 Empty launcher</a></li>
<li><a href="#sec-2-9-2">2.9.2 Create systray</a></li>
<li><a href="#sec-2-9-3">2.9.3 Create a wibox for each screen and add it</a></li>
<li><a href="#sec-2-9-4">2.9.4 Define widgets</a></li>
<li><a href="#sec-2-9-5">2.9.5 Assemble it</a></li>
<li><a href="#sec-2-9-6">2.9.6 Shifty initialize</a></li>
</ul>
</li>
<li><a href="#sec-2-10">2.10 Mouse bindings</a></li>
<li><a href="#sec-2-11">2.11 Key bindings</a>
<ul>
<li><a href="#sec-2-11-1">2.11.1 Some functions</a></li>
<li><a href="#sec-2-11-2">2.11.2 Global keys</a></li>
<li><a href="#sec-2-11-3">2.11.3 Client keys</a></li>
<li><a href="#sec-2-11-4">2.11.4 Shifty client keys</a></li>
</ul>
</li>
<li><a href="#sec-2-12">2.12 Compute the maximum number of digit we need, limited to 9</a></li>
<li><a href="#sec-2-13">2.13 Hooks</a></li>
<li><a href="#sec-2-14">2.14 Autostart</a></li>
</ul>
</li>
<li><a href="#sec-3">3 freedesktop</a>
<ul>
<li><a href="#sec-3-1">3.1 desktop.lua</a></li>
<li><a href="#sec-3-2">3.2 menu.lua</a></li>
<li><a href="#sec-3-3">3.3 utils.lua</a></li>
</ul>
</li>
<li><a href="#sec-4">4 myrc</a>
<ul>
<li><a href="#sec-4-1">4.1 mainmenu.lua</a></li>
<li><a href="#sec-4-2">4.2 tagman.lua</a></li>
<li><a href="#sec-4-3">4.3 keybind.lua</a></li>
<li><a href="#sec-4-4">4.4 logmon.lua</a></li>
<li><a href="#sec-4-5">4.5 memory.lua</a></li>
<li><a href="#sec-4-6">4.6 themes.lua</a></li>
</ul>
</li>
<li><a href="#sec-5">5 pipelets</a>
<ul>
<li><a href="#sec-5-1">5.1 temp</a></li>
<li><a href="#sec-5-2">5.2 batmon</a></li>
<li><a href="#sec-5-3">5.3 date</a></li>
<li><a href="#sec-5-4">5.4 mmount</a></li>
</ul>
</li>
<li><a href="#sec-6">6 Autostart</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Old README</h2>
<div class="outline-text-2" id="text-1">

<p>I am sorry, but I <b>DON'T SUPPORT</b> any more. It may not work with newer versions of awesome.
</p>

</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> INSTALL</h3>
<div class="outline-text-3" id="text-1-1">

<p>Config set uses lots of third-party programs. Here is some of them:
</p>
<ul>
<li>rfkill
</li>
<li>inotail
</li>
<li>sensors
</li>
<li>iwevent
</li>
<li>inotifywait
</li>
<li>pkill
</li>
<li>acpitool
</li>
<li>notify-send
</li>
<li>xkb-switch (see <a href="http://github.com/ierton/xkb-switch">http://github.com/ierton/xkb-switch</a>)
</li>
<li>Search for "Environment programs" in rc.lua for more
 xvkbd for laptop branch
</li>
</ul>


<p>
and some well-known files
</p>
<ul>
<li>/var/log/messages (logger should be configureg to not flood it)
</li>
<li>/proc/mounts
</li>
<li>/etc/mtab
</li>
</ul>


<p>
Also rfkill pipelet uses hardcoded WIFI<sub>RFKILL</sub><sub>ID</sub> value. Change it to one your
wifi card uses (see rfkill list). Well, all pipelets are hackish a bit .
</p>
<ol>
<li>#git clone git@github.com:ierton/awesomerc-ierton.git#
</li>
<li>#mv ~/.config/awesome ~/.config/awesome.old#
</li>
<li>#ln -s `pwd`/awesomerc-ierton ~/.config/awesome#
</li>
</ol>



</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> DIRECTORY STRUCTURE</h3>
<div class="outline-text-3" id="text-1-2">

<p>The directory structure of config:
</p>
<p class="verse">
.<br/>
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col class="left" />
</colgroup>
<thead>
</thead>
<tbody>
<tr><td class="left"><a href="http://github.com/terceiro/awesome-freedesktop/tree">http://github.com/terceiro/awesome-freedesktop/tree</a>\\</td></tr>
</tbody>
<tbody>
</tbody>
<tbody>
<tr><td class="left"></td><td class="left">&ndash; keybind.lua                 Library for defining key sequence\\</td></tr>
<tr><td class="left"></td><td class="left">&ndash; mainmenu.lua                Main menu generator\\</td></tr>
<tr><td class="left"></td><td class="left">&ndash; memory.lua                  Registry routines (client states are saved here)\\</td></tr>
<tr><td class="left"></td><td class="left">&ndash; tagman.lua                  Tag routines (renaming, adding, deleting, &hellip;)\\</td></tr>
<tr><td class="left">`&ndash; themes.lua\\</td></tr>
</tbody>
<tbody>
</tbody>
<tbody>
</tbody>
<tbody>
</tbody>
<tbody>
<tr><td class="left"></td><td class="left">&ndash; blue-black-red              My current theme files are here\\</td></tr>
<tr><td class="left"></td><td class="left"></td><td class="left">&ndash; theme.lua               My current theme config\\</td></tr>
<tr><td class="left"></td><td class="left">`&ndash; titlebar\\</td></tr>
<tr><td class="left">`&ndash; &hellip; more\\</td></tr>
<tr><td class="left">Another default theme\\</td></tr>
</tbody>
<tbody>
<tr><td class="left"></td><td class="left">&ndash; date                        Russian-language date pipelet\\</td></tr>
<tr><td class="left"></td><td class="left">&ndash; mmount                      Mount info pipelet\\</td></tr>
<tr><td class="left"></td><td class="left">&ndash; batmon                      Battery info pipelet\\</td></tr>
<tr><td class="left">`&ndash; more\\</td></tr>
</tbody>
<tbody>
<tr><td class="left">Main thing for registry to work\\</td></tr>
</tbody>
</table>

</p>


</div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> PIPELETS</h3>
<div class="outline-text-3" id="text-1-3">

<p>This config uses pipelets to post some information into widgets.
pipelet is a program (shell script), which is "conected" 
with widget via pipe. 
</p>
<p>
All plumbery is hidden in the ./pipeman script. It translates stdout
of its children into awesome calls.
</p>
<p>
See rc.lua for details and examples.
</p>
</div>

</div>

<div id="outline-container-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> DEFAULT KEYBINDINGS</h3>
<div class="outline-text-3" id="text-1-4">



<p>
Here are some default bindings:
</p>

</div>

<div id="outline-container-1-4-1" class="outline-4">
<h4 id="sec-1-4-1"><span class="section-number-4">1.4.1</span> Client keys</h4>
<div class="outline-text-4" id="text-1-4-1">


<p>
altkey+1 - prev client
altkey+j - prev client
altkey+2 - next client
altkey+k - next client
altkey+tab - toggle last 2 active clients
altkey+3 - begin client manipulation menu (tooltip will appear)
</p>
</div>

</div>

<div id="outline-container-1-4-2" class="outline-4">
<h4 id="sec-1-4-2"><span class="section-number-4">1.4.2</span> Tag keys</h4>
<div class="outline-text-4" id="text-1-4-2">


<p>
altkey+F1 - jump to one tag left
altkey+F2 - jump to one tag right
modkey+F1 - move focused client one tag left
modkey+F2 - move focused client one tag right
modkey+tab - switch to previous tag
altkey+F3 - begin tag manipulation menu (tooltip will appear)
</p>
</div>

</div>

<div id="outline-container-1-4-3" class="outline-4">
<h4 id="sec-1-4-3"><span class="section-number-4">1.4.3</span> Other</h4>
<div class="outline-text-4" id="text-1-4-3">


<p>
altkey+Esc - show main menu
altkey+e - begin mpd manipulation menu (tooltip will appear)
</p>
<p>
There are vim style keybindings defined for menus 
(hjkl - move, o - open, x - back, Enter - open)
</p>

</div>
</div>

</div>

<div id="outline-container-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> <span class="todo TODO">TODO</span></h3>
<div class="outline-text-3" id="text-1-5">


<ul>
<li>Add client reordering
</li>
<li>Implement M$Windows alt+tab functionality (don't know how capture altkey release event)
</li>
<li>Add some online translator support
</li>
</ul>


<p>
--
Thanks for your interest! 
</p>

</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> rc.lua</h2>
<div class="outline-text-2" id="text-2">

<p>This is the default rc.lua file for awesome (which is awesome). It is heavily based on <a href="https://github.com/ierton/awesomerc-ierton">https://github.com/ierton/awesomerc-ierton</a>
</p>
</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Include libraries</h3>
<div class="outline-text-3" id="text-2-1">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Include awesome libraries, with lots of useful function!</span>
require(<span style="color: #ffff00;">"awful"</span>)
require(<span style="color: #ffff00;">"awful.titlebar"</span>)
require(<span style="color: #ffff00;">"awful.autofocus"</span>)
require(<span style="color: #ffff00;">"awesome"</span>)
require(<span style="color: #ffff00;">"client"</span>)
require(<span style="color: #ffff00;">"screen"</span>)
require(<span style="color: #ffff00;">"beautiful"</span>)
require(<span style="color: #ffff00;">"naughty"</span>)
require(<span style="color: #ffff00;">"freedesktop.utils"</span>)
require(<span style="color: #ffff00;">"freedesktop.menu"</span>)

require(<span style="color: #ffff00;">"tsave"</span>)
require(<span style="color: #ffff00;">"pipelets"</span>)

require(<span style="color: #ffff00;">"myrc.mainmenu"</span>)
require(<span style="color: #ffff00;">"myrc.tagman"</span>)
require(<span style="color: #ffff00;">"myrc.themes"</span>)
require(<span style="color: #ffff00;">"myrc.keybind"</span>)
require(<span style="color: #ffff00;">"myrc.memory"</span>)
require(<span style="color: #ffff00;">"myrc.logmon"</span>)

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">shifty - dynamic tagging library</span>
require(<span style="color: #ffff00;">"shifty"</span>)
</pre>

</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Debug</h3>
<div class="outline-text-3" id="text-2-2">




<pre class="src src-lua"><span style="color: #ff0000;">--{{{ Debug </span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">dbg</span>(vars)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">text</span> = <span style="color: #ffff00;">""</span>
   <span style="color: #00ffff;">for</span> i=1, #vars-1 <span style="color: #00ffff;">do</span> text = text .. tostring(vars[i]) .. <span style="color: #ffff00;">" | "</span> <span style="color: #00ffff;">end</span>
   text = text .. tostring(vars[#vars])
   naughty.notify({ text = text, timeout = 10 })
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">dbg_client</span>(c)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">text</span> = <span style="color: #ffff00;">""</span>
   <span style="color: #00ffff;">if</span> c.class <span style="color: #00ffff;">then</span>
      text = text .. <span style="color: #ffff00;">"Class: "</span> .. c.class .. <span style="color: #ffff00;">" "</span>
   <span style="color: #00ffff;">end</span>
   <span style="color: #00ffff;">if</span> c.instance <span style="color: #00ffff;">then</span>
      text = text .. <span style="color: #ffff00;">"Instance: "</span>.. c.instance .. <span style="color: #ffff00;">" "</span>
   <span style="color: #00ffff;">end</span>
   <span style="color: #00ffff;">if</span> c.role <span style="color: #00ffff;">then</span>
      text = text .. <span style="color: #ffff00;">"Role: "</span>.. c.role .. <span style="color: #ffff00;">" "</span>
   <span style="color: #00ffff;">end</span>
   <span style="color: #00ffff;">if</span> c.type <span style="color: #00ffff;">then</span>
      text = text .. <span style="color: #ffff00;">"Type: "</span>.. c.type .. <span style="color: #ffff00;">" "</span>
   <span style="color: #00ffff;">end</span>

   text = text .. <span style="color: #ffff00;">"Full name: '"</span> .. client_name(c) .. <span style="color: #ffff00;">"'"</span>

   dbg({text})
<span style="color: #00ffff;">end</span>
<span style="color: #ff0000;">--}}}</span>
</pre>

</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Run or raise function</h3>
<div class="outline-text-3" id="text-2-3">




<pre class="src src-lua">  <span style="color: #ff0000;">--{{{ Run or raise</span>
<span style="color: #ff0000;">--- Spawns cmd if no client can be found matching properties</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">If such a client can be found, pop to first tag where it is visible, and give it focus</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@param cmd the command to execute</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@param properties a table of properties to match against clients.  Possible entries: any properties of the client object</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">run_or_raise</span>(cmd, properties)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">clients</span> = client.get()
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">focused</span> = awful.client.next(0)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">findex</span> = 0
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">matched_clients</span> = {}
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">n</span> = 0

   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Returns true if all pairs in table1 are present in table2</span>
   <span style="color: #00ffff;">function</span> <span style="color: #4186be;">match</span> (table1, table2)
      <span style="color: #00ffff;">for</span> k, v <span style="color: #00ffff;">in</span> pairs(table1) <span style="color: #00ffff;">do</span>
         <span style="color: #00ffff;">if</span> table2[k] ~= v <span style="color: #00ffff;">and</span> <span style="color: #00ffff;">not</span> table2[k]:find(v) <span style="color: #00ffff;">then</span>
            <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">false</span>
         <span style="color: #00ffff;">end</span>
      <span style="color: #00ffff;">end</span>
      <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">true</span>
   <span style="color: #00ffff;">end</span>

   <span style="color: #00ffff;">for</span> i, c <span style="color: #00ffff;">in</span> pairs(clients) <span style="color: #00ffff;">do</span>
      <span style="color: #ff0000;">--make an array of matched clients</span>
      <span style="color: #00ffff;">if</span> match(properties, c) <span style="color: #00ffff;">then</span>
         n = n + 1
         matched_clients[n] = c
         <span style="color: #00ffff;">if</span> c == focused <span style="color: #00ffff;">then</span>
            findex = n
         <span style="color: #00ffff;">end</span>
      <span style="color: #00ffff;">end</span>
   <span style="color: #00ffff;">end</span>
   <span style="color: #00ffff;">if</span> n &gt; 0 <span style="color: #00ffff;">then</span>
      <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">c</span> = matched_clients[1]
      <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">if the focused window matched switch focus to next in list</span>
      <span style="color: #00ffff;">if</span> 0 &lt; findex <span style="color: #00ffff;">and</span> findex &lt; n <span style="color: #00ffff;">then</span>
         c = matched_clients[findex+1]
      <span style="color: #00ffff;">end</span>
      <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">ctags</span> = c:tags()
      <span style="color: #00ffff;">if</span> table.getn(ctags) == 0 <span style="color: #00ffff;">then</span>
         <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">ctags is empty, show client on current tag</span>
         <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">curtag</span> = awful.tag.selected()
         awful.client.movetotag(curtag, c)
      <span style="color: #00ffff;">else</span>
         <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Otherwise, pop to first tag client is visible on</span>
         awful.tag.viewonly(ctags[1])
      <span style="color: #00ffff;">end</span>
      <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">And then focus the client</span>
      <span style="color: #00ffff;">if</span> client.focus == c <span style="color: #00ffff;">then</span>
         c:tags({})
      <span style="color: #00ffff;">else</span>
         client.focus = c
         c:raise()
      <span style="color: #00ffff;">end</span>
      <span style="color: #00ffff;">return</span>
   <span style="color: #00ffff;">end</span>
   awful.util.spawn(cmd, <span style="color: #00ffff;">false</span>)
<span style="color: #00ffff;">end</span>
<span style="color: #ff0000;">--}}}</span>
</pre>

</div>

</div>

<div id="outline-container-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Execute adjustMonitor</h3>
<div class="outline-text-3" id="text-2-4">




<pre class="src src-lua">awful.util.spawn_with_shell(<span style="color: #ffff00;">"adjustMonitor"</span>)
</pre>


</div>

</div>

<div id="outline-container-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> Data serialisation helpers</h3>
<div class="outline-text-3" id="text-2-5">




<pre class="src src-lua">  <span style="color: #ff0000;">--{{{ Data serialisation helpers</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">client_name</span>(c)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">cls</span> = c.class <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">""</span>
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">inst</span> = c.instance <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">""</span>
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">role</span> = c.role <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">""</span>
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">ctype</span> = c.type <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">""</span>
   <span style="color: #00ffff;">return</span> cls..<span style="color: #ffff00;">":"</span>..inst..<span style="color: #ffff00;">":"</span>..role..<span style="color: #ffff00;">":"</span>..ctype
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">where can be 'left' 'right' 'center' nil</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">client_snap</span>(c, where, geom)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">sg</span> = screen[c.screen].geometry
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">cg</span> = geom <span style="color: #00ffff;">or</span> c:geometry()
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">cs</span> = c:struts()
   cs[<span style="color: #ffff00;">'left'</span>] = 0
   cs[<span style="color: #ffff00;">'top'</span>] = 0
   cs[<span style="color: #ffff00;">'bottom'</span>] = 0
   cs[<span style="color: #ffff00;">'right'</span>] = 0
   <span style="color: #00ffff;">if</span> where == <span style="color: #ffff00;">'right'</span> <span style="color: #00ffff;">then</span>
      cg.x = sg.width - cg.width
      cs[where] = cg.width
      c:struts(cs)
      c:geometry(cg)
   <span style="color: #00ffff;">elseif</span> where == <span style="color: #ffff00;">'left'</span> <span style="color: #00ffff;">then</span>
      cg.x = 0
      cs[where] = cg.width
      c:struts(cs)
      c:geometry(cg)
   <span style="color: #00ffff;">elseif</span> where == <span style="color: #ffff00;">'bottom'</span> <span style="color: #00ffff;">then</span>
      awful.placement.centered(c)
      cg = c:geometry()
      cg.y = sg.height - cg.height - beautiful.wibox_bottom_height
      cs[where] = cg.height + beautiful.wibox_bottom_height
      c:struts(cs)
      c:geometry(cg)
   <span style="color: #00ffff;">elseif</span> where == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
      c:struts(cs)
      c:geometry(cg)
   <span style="color: #00ffff;">elseif</span> where == <span style="color: #ffff00;">'center'</span> <span style="color: #00ffff;">then</span>
      c:struts(cs)
      awful.placement.centered(c)
   <span style="color: #00ffff;">else</span>
      <span style="color: #00ffff;">return</span>
   <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_geometry</span>(c, g)
   myrc.memory.set(<span style="color: #ffff00;">"geometry"</span>, client_name(c), g)
   <span style="color: #00ffff;">if</span> g ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
      c:geometry(g)
   <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_floating</span>(c, f)
   myrc.memory.set(<span style="color: #ffff00;">"floating"</span>, client_name(c), f)
   awful.client.floating.set(c, f)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_titlebar</span>(c, val)
   myrc.memory.set(<span style="color: #ffff00;">"titlebar"</span>, client_name(c), val)
   <span style="color: #00ffff;">if</span> val == <span style="color: #00ffff;">true</span> <span style="color: #00ffff;">then</span>
      awful.titlebar.add(c, { modkey = modkey })
   <span style="color: #00ffff;">elseif</span> val == <span style="color: #00ffff;">false</span> <span style="color: #00ffff;">then</span>
      awful.titlebar.remove(c)
   <span style="color: #00ffff;">end</span>
   <span style="color: #00ffff;">return</span> val
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get_titlebar</span>(c, def)
   <span style="color: #00ffff;">return</span> myrc.memory.get(<span style="color: #ffff00;">"titlebar"</span>, client_name(c), def)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_tag</span>(c, tag)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tn</span> = <span style="color: #ffff00;">"none"</span>
   <span style="color: #00ffff;">if</span> tag <span style="color: #00ffff;">then</span> tn = tag.name <span style="color: #00ffff;">end</span>
   myrc.memory.set(<span style="color: #ffff00;">"tags"</span>, client_name(c), tn)
   <span style="color: #00ffff;">if</span> tag ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">and</span> tag ~= awful.tag.selected() <span style="color: #00ffff;">then</span> 
      awful.client.movetotag(tag, c) 
   <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get_tag</span>(c, def)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tn</span> = myrc.memory.get(<span style="color: #ffff00;">"tags"</span>, client_name(c), def)
   <span style="color: #00ffff;">return</span> myrc.tagman.find(tn)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_dockable</span>(c, val)
   myrc.memory.set(<span style="color: #ffff00;">"dockable"</span>, client_name(c), val)
   awful.client.dockable.set(c, val)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get_dockable</span>(c, def)
   <span style="color: #00ffff;">return</span> myrc.memory.get(<span style="color: #ffff00;">"dockable"</span>, client_name(c), def)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_hor</span>(c, val)
   myrc.memory.set(<span style="color: #ffff00;">"maxhor"</span>, client_name(c), val)
   c.maximized_horizontal = val
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get_hor</span>(c, def)
   <span style="color: #00ffff;">return</span> myrc.memory.get(<span style="color: #ffff00;">"maxhor"</span>, client_name(c), def)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_vert</span>(c, val)
   myrc.memory.set(<span style="color: #ffff00;">"maxvert"</span>, client_name(c), val)
   c.maximized_vertical = val
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get_vert</span>(c, def)
   <span style="color: #00ffff;">return</span> myrc.memory.get(<span style="color: #ffff00;">"maxvert"</span>, client_name(c), def)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_snap</span>(c, val)
   myrc.memory.set(<span style="color: #ffff00;">"snap"</span>, client_name(c), val)
   client_snap(c, val)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get_snap</span>(c, def)
   <span style="color: #00ffff;">return</span> myrc.memory.get(<span style="color: #ffff00;">"snap"</span>, client_name(c), def)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_hidden</span>(c, val)
   myrc.memory.set(<span style="color: #ffff00;">"hidden"</span>, client_name(c), val)
   c.skip_taskbar = val
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get_hidden</span>(c, def)
   <span style="color: #00ffff;">return</span> myrc.memory.get(<span style="color: #ffff00;">"hidden"</span>, client_name(c), def)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get_border</span>(c, def)
   <span style="color: #00ffff;">return</span> myrc.memory.get(<span style="color: #ffff00;">"border"</span>, client_name(c), def)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get_layout_border</span>(c)
   <span style="color: #00ffff;">if</span> awful.client.floating.get(c) == <span style="color: #00ffff;">false</span> <span style="color: #00ffff;">and</span> 
      awful.layout.get() == awful.layout.suit.max
   <span style="color: #00ffff;">then</span>
      <span style="color: #00ffff;">return</span> 0
   <span style="color: #00ffff;">else</span>
      <span style="color: #00ffff;">return</span> get_border(c, beautiful.border_width)
   <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">save_border</span>(c, val)
   myrc.memory.set(<span style="color: #ffff00;">"border"</span>, client_name(c), val)
   c.border_width = get_layout_border(c)
<span style="color: #00ffff;">end</span>
<span style="color: #ff0000;">--}}}</span>
</pre>

</div>

</div>

<div id="outline-container-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> Menu helpers</h3>
<div class="outline-text-3" id="text-2-6">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Menu helpers--{{{</span>
mymenu = <span style="color: #00ffff;">nil</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">menu_hide</span>()
   <span style="color: #00ffff;">if</span> mymenu ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
      mymenu:hide()
      mymenu = <span style="color: #00ffff;">nil</span>
   <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">menu_current</span>(menu, args)
   <span style="color: #00ffff;">if</span> mymenu ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">and</span> mymenu ~= menu <span style="color: #00ffff;">then</span>
      mymenu:hide()
   <span style="color: #00ffff;">end</span>
   mymenu = menu
   mymenu:show(args)
   <span style="color: #00ffff;">return</span> mymenu
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">client_contex_menu</span>(c)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">mp</span> = mouse.coords()
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">menupos</span> = {x = mp.x-1*beautiful.menu_width/3, y = mp.y}

   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">menuitmes</span> = {
      {<span style="color: #ffff00;">"               ::: "</span>..c.class..<span style="color: #ffff00;">" :::"</span> ,<span style="color: #00ffff;">nil</span>,<span style="color: #00ffff;">nil</span>}
      ,

      {<span style="color: #ffff00;">"&amp;Q Kill"</span>, <span style="color: #00ffff;">function</span> () 
          c:kill()
                  <span style="color: #00ffff;">end</span>},

      {<span style="color: #ffff00;">""</span>,<span style="color: #00ffff;">nil</span>,<span style="color: #00ffff;">nil</span>}
      ,

      {<span style="color: #ffff00;">"&amp;F Floating"</span>, {
          { <span style="color: #ffff00;">"&amp;Enable"</span>, <span style="color: #00ffff;">function</span> () 
               save_floating(c, <span style="color: #00ffff;">true</span>)
                       <span style="color: #00ffff;">end</span>},
          { <span style="color: #ffff00;">"&amp;Disable"</span>, <span style="color: #00ffff;">function</span> () 
               save_floating(c, <span style="color: #00ffff;">false</span>)
                        <span style="color: #00ffff;">end</span>}
                      }},

      {<span style="color: #ffff00;">"&amp;T Titlebar"</span>, {
          { <span style="color: #ffff00;">"&amp;Enable"</span> , <span style="color: #00ffff;">function</span> () 
               save_titlebar(c, <span style="color: #00ffff;">true</span>)
                        <span style="color: #00ffff;">end</span>},

          {<span style="color: #ffff00;">"&amp;Disable"</span>, <span style="color: #00ffff;">function</span> () 
              save_titlebar(c, <span style="color: #00ffff;">false</span>)
                       <span style="color: #00ffff;">end</span>},
                      }},

      {<span style="color: #ffff00;">"&amp;G Geometry"</span>, {
          { <span style="color: #ffff00;">"&amp;Save"</span> , <span style="color: #00ffff;">function</span> () 
               save_geometry(c, c:geometry())
                      <span style="color: #00ffff;">end</span>},

          {<span style="color: #ffff00;">"&amp;Clear"</span>, <span style="color: #00ffff;">function</span> () 
              save_geometry(c, <span style="color: #00ffff;">nil</span>)
                     <span style="color: #00ffff;">end</span>},
                      }},

      {<span style="color: #ffff00;">"&amp;V Fullscreen vert"</span>, {
          {<span style="color: #ffff00;">"&amp;Enable"</span>, <span style="color: #00ffff;">function</span> () 
              save_vert(c, <span style="color: #00ffff;">true</span>) 
                      <span style="color: #00ffff;">end</span>},
          {<span style="color: #ffff00;">"&amp;Disable"</span> , <span style="color: #00ffff;">function</span> () 
              save_vert(c, <span style="color: #00ffff;">false</span>) 
                        <span style="color: #00ffff;">end</span>},
                             }},

      {<span style="color: #ffff00;">"&amp;H Fullscreen hor"</span>, {
          {<span style="color: #ffff00;">"&amp;Enable"</span>, <span style="color: #00ffff;">function</span> () 
              save_hor(c, <span style="color: #00ffff;">true</span>) 
                      <span style="color: #00ffff;">end</span>},
          {<span style="color: #ffff00;">"&amp;Disable"</span> , <span style="color: #00ffff;">function</span> () 
              save_hor(c, <span style="color: #00ffff;">false</span>) 
                        <span style="color: #00ffff;">end</span>},
                            }},

      {<span style="color: #ffff00;">"&amp;S Snap"</span>, {
          { <span style="color: #ffff00;">"&amp;Center"</span>, <span style="color: #00ffff;">function</span> () 
               save_snap(c, <span style="color: #ffff00;">'center'</span>)
                       <span style="color: #00ffff;">end</span>},

          {<span style="color: #ffff00;">"&amp;Right"</span>, <span style="color: #00ffff;">function</span> () 
              save_snap(c, <span style="color: #ffff00;">'right'</span>)
                     <span style="color: #00ffff;">end</span>},

          {<span style="color: #ffff00;">"&amp;Left"</span>, <span style="color: #00ffff;">function</span> () 
              save_snap(c, <span style="color: #ffff00;">'left'</span>)
                    <span style="color: #00ffff;">end</span>},

          {<span style="color: #ffff00;">"&amp;Bottom"</span>, <span style="color: #00ffff;">function</span> () 
              save_snap(c, <span style="color: #ffff00;">'bottom'</span>)
                      <span style="color: #00ffff;">end</span>},

          {<span style="color: #ffff00;">"&amp;Off"</span>, <span style="color: #00ffff;">function</span> () 
              save_snap(c, <span style="color: #00ffff;">nil</span>)
                   <span style="color: #00ffff;">end</span>},
                  }},

      {<span style="color: #ffff00;">"&amp;B Border"</span>, {
          { <span style="color: #ffff00;">"&amp;None"</span>, <span style="color: #00ffff;">function</span> () 
               save_border(c, 0)
                     <span style="color: #00ffff;">end</span>},

          {<span style="color: #ffff00;">"&amp;One"</span>, <span style="color: #00ffff;">function</span> () 
              save_border(c, 1)
                   <span style="color: #00ffff;">end</span>},

          {<span style="color: #ffff00;">"&amp;Default"</span>, <span style="color: #00ffff;">function</span> () 
              save_border(c, <span style="color: #00ffff;">nil</span>)
                       <span style="color: #00ffff;">end</span>},
                    }},

      {<span style="color: #ffff00;">"&amp;S Stick"</span>, {
          { <span style="color: #ffff00;">"To &amp;this tag"</span>, 
            <span style="color: #00ffff;">function</span> () 
               <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">t</span> = awful.tag.selected()
               save_tag(c, t) 
               naughty.notify({text = <span style="color: #ffff00;">"Client "</span> .. c.name .. <span style="color: #ffff00;">" has been sticked to tag "</span> .. t.name}) 
            <span style="color: #00ffff;">end</span>}, 

          {<span style="color: #ffff00;">"To &amp;none"</span>, <span style="color: #00ffff;">function</span> () 
              save_tag(c, <span style="color: #00ffff;">nil</span>) 
              naughty.notify({text = <span style="color: #ffff00;">"Client "</span> .. c.name .. <span style="color: #ffff00;">" has been unsticked from tag"</span>}) 
                       <span style="color: #00ffff;">end</span>},
                   }},

      { <span style="color: #ffff00;">"&amp;I Hidden"</span>, {
           {<span style="color: #ffff00;">"&amp;Enable"</span>, <span style="color: #00ffff;">function</span> () 
               save_hidden(c, <span style="color: #00ffff;">true</span>) 
                       <span style="color: #00ffff;">end</span>},
           {<span style="color: #ffff00;">"&amp;Disable"</span> , <span style="color: #00ffff;">function</span> () 
               save_hidden(c, <span style="color: #00ffff;">false</span>) 
                         <span style="color: #00ffff;">end</span>},
                     }},

      {<span style="color: #ffff00;">"&amp;R Rename"</span>, <span style="color: #00ffff;">function</span> () 
          awful.prompt.run(
             { prompt = <span style="color: #ffff00;">"Rename client: "</span> }, 
             mypromptbox[mouse.screen].widget, 
             <span style="color: #00ffff;">function</span>(n) 
                awful.client.property.set(c,<span style="color: #ffff00;">"label"</span>, n) 
             <span style="color: #00ffff;">end</span>,
             awful.completion.bash,
             awful.util.getdir(<span style="color: #ffff00;">"cache"</span>) .. <span style="color: #ffff00;">"/rename"</span>)
                    <span style="color: #00ffff;">end</span>},
   } 

   <span style="color: #00ffff;">return</span> awful.menu( { items = menuitmes, height = theme.menu_context_height } ), menupos
<span style="color: #00ffff;">end</span><span style="color: #ff0000;">--}}}</span>
</pre>

</div>

</div>

<div id="outline-container-2-7" class="outline-3">
<h3 id="sec-2-7"><span class="section-number-3">2.7</span> Variable definitions</h3>
<div class="outline-text-3" id="text-2-7">


</div>

<div id="outline-container-2-7-1" class="outline-4">
<h4 id="sec-2-7-1"><span class="section-number-4">2.7.1</span> Default modkey</h4>
<div class="outline-text-4" id="text-2-7-1">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">{{{ Variable definitions</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Default modkey.</span>
modkey = <span style="color: #ffff00;">"Mod4"</span>
altkey = <span style="color: #ffff00;">"Mod1"</span>
</pre>

</div>

</div>

<div id="outline-container-2-7-2" class="outline-4">
<h4 id="sec-2-7-2"><span class="section-number-4">2.7.2</span> Environment programs</h4>
<div class="outline-text-4" id="text-2-7-2">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Environment programs</span>
env = {
   browser = <span style="color: #ffff00;">"firefox "</span>,
   email = <span style="color: #ffff00;">"thunderbird "</span>,
   man = <span style="color: #ffff00;">"xterm -e man "</span>,
   terminal = <span style="color: #ffff00;">"xterm "</span>, 
   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">screen = "xterm -e screen",</span>
   fileman = <span style="color: #ffff00;">"nautilus"</span>,
   terminal_root = <span style="color: #ffff00;">"xterm -e su -c screen"</span>,
   im = <span style="color: #ffff00;">"pidgin "</span>,
   editor = os.getenv(<span style="color: #ffff00;">"EDITOR"</span>) <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"ec "</span>,
   home_dir = os.getenv(<span style="color: #ffff00;">"HOME"</span>),
   music_show = <span style="color: #ffff00;">"gmpc --replace"</span>,
   music_hide = <span style="color: #ffff00;">"gmpc --quit"</span>,
   run = <span style="color: #ffff00;">"gmrun"</span>,
   locker = <span style="color: #ffff00;">"xscreensaver-command -lock"</span>,
   xkill = <span style="color: #ffff00;">"xkill"</span>,
   poweroff = <span style="color: #ffff00;">"sudo /sbin/poweroff"</span>,
   reboot = <span style="color: #ffff00;">"sudo /sbin/reboot"</span>,
   hibernate = <span style="color: #ffff00;">"sudo /usr/sbin/pm-hibernate"</span>,
   suspend = <span style="color: #ffff00;">"sudo /usr/sbin/pm-suspend"</span>,
   rotate = <span style="color: #ffff00;">"rotator"</span>,
   rfkill = { 
      wifi = <span style="color: #ffff00;">"sudo /usr/local/bin/laptop-net wifi"</span>, 
      wimax = <span style="color: #ffff00;">"sudo /usr/local/bin/laptop-net wimax"</span>,
      off = <span style="color: #ffff00;">"sudo /usr/local/bin/laptop-net off"</span>},
   syslog = <span style="color: #ffff00;">"urxvt -e vim -T xterm-256color /var/log/messages"</span>,
   volumecontrol = <span style="color: #ffff00;">"pavucontrol "</span>
}

</pre>

</div>

</div>

<div id="outline-container-2-7-3" class="outline-4">
<h4 id="sec-2-7-3"><span class="section-number-4">2.7.3</span> Default modkey</h4>
<div class="outline-text-4" id="text-2-7-3">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Pipelets</span>
pipelets.config.script_path = awful.util.getdir(<span style="color: #ffff00;">"config"</span>)..<span style="color: #ffff00;">"/pipelets/"</span>

</pre>

</div>

</div>

<div id="outline-container-2-7-4" class="outline-4">
<h4 id="sec-2-7-4"><span class="section-number-4">2.7.4</span> Naughty</h4>
<div class="outline-text-4" id="text-2-7-4">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Naughty</span>
naughty.config.presets.keybind = {
   position = <span style="color: #ffff00;">'top_left'</span>,
   timeout = 0,
}
logmon_width = 180
naughty.config.position = <span style="color: #ffff00;">'top_right'</span>
naughty.config.presets.low.width = logmon_width
naughty.config.presets.normal.width = logmon_width
naughty.config.presets.critical.width = logmon_width

</pre>

</div>

</div>

<div id="outline-container-2-7-5" class="outline-4">
<h4 id="sec-2-7-5"><span class="section-number-4">2.7.5</span> Table of layouts</h4>
<div class="outline-text-4" id="text-2-7-5">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Table of layouts to cover with awful.layout.inc, order matters.</span>
layouts = 
   {
   awful.layout.suit.max,
   awful.layout.suit.tile.bottom,
   awful.layout.suit.tile,
   awful.layout.suit.tile.left,
   awful.layout.suit.tile.top,
   awful.layout.suit.fair,
   awful.layout.suit.fair.horizontal,
   awful.layout.suit.magnifier,
   awful.layout.suit.floating
   }

   awful.menu.menu_keys = {
      up={ <span style="color: #ffff00;">"Up"</span>, <span style="color: #ffff00;">'k'</span> }, 
      down = { <span style="color: #ffff00;">"Down"</span>, <span style="color: #ffff00;">'j'</span> }, 
      back = { <span style="color: #ffff00;">"Left"</span>, <span style="color: #ffff00;">'x'</span>, <span style="color: #ffff00;">'h'</span> }, 
      exec = { <span style="color: #ffff00;">"Return"</span>, <span style="color: #ffff00;">"Right"</span>, <span style="color: #ffff00;">'o'</span>, <span style="color: #ffff00;">'l'</span> },
      close = { <span style="color: #ffff00;">"Escape"</span> }
   }

   contextmenu_args = {
      coords={ x=0, y=0 },
      keygrabber = <span style="color: #00ffff;">true</span>
   }

   mainmenu_args = {
      coords={ x=0, y=0 },
      keygrabber = <span style="color: #00ffff;">true</span>
   }

   chord_menu_args = {
      coords={ x=0, y=0 },
      keygrabber = <span style="color: #00ffff;">false</span>
   }

   myrc.memory.init()

   beautiful.init(myrc.themes.current())

</pre>

</div>

</div>

<div id="outline-container-2-7-6" class="outline-4">
<h4 id="sec-2-7-6"><span class="section-number-4">2.7.6</span> Custom Icons</h4>
<div class="outline-text-4" id="text-2-7-6">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Custom icons</span>
clientmenu_icon = beautiful.clientmenu_icon <span style="color: #00ffff;">or</span> beautiful.awesome_icon
kbd_icon = beautiful.xvkbd_icon <span style="color: #00ffff;">or</span> beautiful.awesome_icon

myrc.mainmenu.init(env)

myrc.tagman.init(<span style="color: #00ffff;">function</span>(s) <span style="color: #00ffff;">return</span> myrc.memory.get(<span style="color: #ffff00;">"tagnames"</span>, tostring(s), <span style="color: #00ffff;">nil</span>) <span style="color: #00ffff;">end</span>)

myrc.logmon.init()

pipelets.init()
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">}}}</span>
</pre>

</div>
</div>

</div>

<div id="outline-container-2-8" class="outline-3">
<h3 id="sec-2-8"><span class="section-number-3">2.8</span> Shifty</h3>
<div class="outline-text-3" id="text-2-8">


</div>

<div id="outline-container-2-8-1" class="outline-4">
<h4 id="sec-2-8-1"><span class="section-number-4">2.8.1</span> Shifty Configured tags</h4>
<div class="outline-text-4" id="text-2-8-1">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Shifty configured tags.</span>
shifty.config.tags = {
   w1 = {
      layout    = awful.layout.suit.max,
      mwfact    = 0.60,
      exclusive = <span style="color: #00ffff;">false</span>,
      position  = 1,
      init      = <span style="color: #00ffff;">true</span>,
      screen    = 1,
      slave     = <span style="color: #00ffff;">true</span>,
   },
   web = {
      layout      = awful.layout.suit.tile.bottom,
      mwfact      = 0.65,
      exclusive   = <span style="color: #00ffff;">true</span>,
      max_clients = <span style="color: #00ffff;">true</span>,
      position    = 4,
      spawn       = browser,
   },
   mail = {
      layout    = awful.layout.suit.tile,
      mwfact    = 0.55,
      exclusive = <span style="color: #00ffff;">false</span>,
      position  = 5,
      spawn     = mail,
      slave     = <span style="color: #00ffff;">true</span>
   },
   skype = {
      layout    = awful.layout.suit.tile,
      mwfact    = 0.55,
      exclusive = <span style="color: #00ffff;">false</span>,
      position  = 6,
      spawn     = skype,
      slave     = <span style="color: #00ffff;">true</span>
   },
   emacs = {
      layout    = awful.layout.suit.tile,
      mwfact    = 0.55,
      exclusive = <span style="color: #00ffff;">false</span>,
      position  = 5,
      spawn     = emacs,
      slave     = <span style="color: #00ffff;">true</span>
   },
   media = {
      layout    = awful.layout.suit.float,
      exclusive = <span style="color: #00ffff;">false</span>,
      position  = 8,
   },
   office = {
      layout   = awful.layout.suit.tile,
      position = 9,
   },
}
</pre>

</div>

</div>

<div id="outline-container-2-8-2" class="outline-4">
<h4 id="sec-2-8-2"><span class="section-number-4">2.8.2</span> Shifty application matching rules</h4>
<div class="outline-text-4" id="text-2-8-2">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">SHIFTY: application matching rules</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">order here matters, early rules will be applied first</span>
shifty.config.apps = {
    {
        match = {
            <span style="color: #ffff00;">"Navigator"</span>,
            <span style="color: #ffff00;">"Vimperator"</span>,
            <span style="color: #ffff00;">"Gran Paradiso"</span>,
        },
        tag = <span style="color: #ffff00;">"web"</span>,
    },
    {
        match = {
            <span style="color: #ffff00;">"Shredder.*"</span>,
            <span style="color: #ffff00;">"Thunderbird"</span>,
            <span style="color: #ffff00;">"mutt"</span>,
        },
        tag = <span style="color: #ffff00;">"mail"</span>,
    },
    {
        match = {
            <span style="color: #ffff00;">"pcmanfm"</span>,
        },
        slave = <span style="color: #00ffff;">true</span>
    },
    {
        match = {
            <span style="color: #ffff00;">"OpenOffice.*"</span>,
            <span style="color: #ffff00;">"Abiword"</span>,
            <span style="color: #ffff00;">"Gnumeric"</span>,
            <span style="color: #ffff00;">"Lyx"</span>
        },
        tag = <span style="color: #ffff00;">"office"</span>,
    },
    {
        match = {
            <span style="color: #ffff00;">"emacs"</span>
        },
        tag = <span style="color: #ffff00;">"emacs"</span>,
    },
    {
        match = {
            <span style="color: #ffff00;">"Mplayer.*"</span>,
            <span style="color: #ffff00;">"Mirage"</span>,
            <span style="color: #ffff00;">"gimp"</span>,
            <span style="color: #ffff00;">"gtkpod"</span>,
            <span style="color: #ffff00;">"Ufraw"</span>,
            <span style="color: #ffff00;">"easytag"</span>,
        },
        tag = <span style="color: #ffff00;">"media"</span>,
        nopopup = <span style="color: #00ffff;">true</span>,
    },
    {
        match = {
            <span style="color: #ffff00;">"MPlayer"</span>,
            <span style="color: #ffff00;">"Gnuplot"</span>,
            <span style="color: #ffff00;">"galculator"</span>,
        },
        float = <span style="color: #00ffff;">true</span>,
    },
    {
        match = {
            <span style="color: #ffff00;">"Skype"</span>,
        },
        tag = <span style="color: #ffff00;">"skype"</span>,
    },
    {
        match = {
            terminal,
        },
        honorsizehints = <span style="color: #00ffff;">false</span>,
        slave = <span style="color: #00ffff;">true</span>,
    },
    {
        match = {<span style="color: #ffff00;">""</span>},
        buttons = awful.util.table.join(
            awful.button({}, 1, <span style="color: #00ffff;">function</span> (c) client.focus = c; c:raise() <span style="color: #00ffff;">end</span>),
            awful.button({modkey}, 1, <span style="color: #00ffff;">function</span>(c)
                client.focus = c
                c:raise()
                awful.mouse.client.move(c)
                <span style="color: #00ffff;">end</span>),
            awful.button({modkey}, 3, awful.mouse.client.resize)
            )
    },
}
</pre>

</div>

</div>

<div id="outline-container-2-8-3" class="outline-4">
<h4 id="sec-2-8-3"><span class="section-number-4">2.8.3</span> Shifty default tag creation rules</h4>
<div class="outline-text-4" id="text-2-8-3">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">SHIFTY: default tag creation rules</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">parameter description</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;"> * floatBars : if floating clients should always have a titlebar</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;"> * guess_name : should shifty try and guess tag names when creating</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">                new (unconfigured) tags?</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;"> * guess_position: as above, but for position parameter</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;"> * run : function to exec when shifty creates a new tag</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;"> * all other parameters (e.g. layout, mwfact) follow awesome's tag API</span>
shifty.config.defaults = {
    layout = awful.layout.suit.tile.bottom,
    ncol = 1,
    mwfact = 0.60,
    floatBars = <span style="color: #00ffff;">true</span>,
    guess_name = <span style="color: #00ffff;">true</span>,
    guess_position = <span style="color: #00ffff;">true</span>,
}
</pre>

</div>
</div>

</div>

<div id="outline-container-2-9" class="outline-3">
<h3 id="sec-2-9"><span class="section-number-3">2.9</span> Wibox</h3>
<div class="outline-text-3" id="text-2-9">


</div>

<div id="outline-container-2-9-1" class="outline-4">
<h4 id="sec-2-9-1"><span class="section-number-4">2.9.1</span> Empty launcher</h4>
<div class="outline-text-4" id="text-2-9-1">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">{{{ Wibox</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Empty launcher</span>
mymainmenu = myrc.mainmenu.build()
mylauncher = awful.widget.button({image = beautiful.awesome_icon})
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Main menu will be placed at left top corner of screen</span>
mylauncher:buttons(awful.util.table.join(mylauncher:buttons(), 
                                         awful.button({}, 1, <span style="color: #00ffff;">nil</span>, <span style="color: #00ffff;">function</span> () menu_current(mymainmenu, mainmenu_args) <span style="color: #00ffff;">end</span>)))

</pre>

</div>

</div>

<div id="outline-container-2-9-2" class="outline-4">
<h4 id="sec-2-9-2"><span class="section-number-4">2.9.2</span> Create systray</h4>
<div class="outline-text-4" id="text-2-9-2">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Create a systray</span>
mysystray = widget({ type = <span style="color: #ffff00;">"systray"</span> })
</pre>

</div>

</div>

<div id="outline-container-2-9-3" class="outline-4">
<h4 id="sec-2-9-3"><span class="section-number-4">2.9.3</span> Create a wibox for each screen and add it</h4>
<div class="outline-text-4" id="text-2-9-3">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Create a wibox for each screen and add it</span>
mytop = {}
mybottom = {}
mypromptbox = {}

myclientmenu = {}
myclientmenu.timer = timer{ timeout=0.7 }
myclientmenu.timer:add_signal(<span style="color: #ffff00;">"timeout"</span>, <span style="color: #00ffff;">function</span>() 
                                 myclientmenu.suppress = <span style="color: #00ffff;">nil</span> 
                                 myclientmenu.timer:stop()
                                         <span style="color: #00ffff;">end</span>)
myclientmenu.buttons = awful.util.table.join(
   awful.button({ }, 1, <span style="color: #00ffff;">function</span> ()
                   <span style="color: #00ffff;">if</span> myclientmenu.suppress ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">end</span>
                   <span style="color: #00ffff;">if</span> client.focus == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">end</span>
                   <span style="color: #00ffff;">local</span> menu, coords = client_contex_menu(client.focus)
                   menu_current(menu, {coords = coords})
                   myclientmenu.suppress = <span style="color: #00ffff;">true</span>
                   myclientmenu.timer:start()
                        <span style="color: #00ffff;">end</span>))

</pre>

</div>

</div>

<div id="outline-container-2-9-4" class="outline-4">
<h4 id="sec-2-9-4"><span class="section-number-4">2.9.4</span> Define widgets</h4>
<div class="outline-text-4" id="text-2-9-4">

<ul>
<li id="sec-2-9-4-1">Clock<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Clock</span>
mytextclock = {}
mytextclock = widget({ type = <span style="color: #ffff00;">"textbox"</span>, align=<span style="color: #ffff00;">"right"</span> })
pipelets.register_fmt(mytextclock, <span style="color: #ffff00;">"date"</span>, <span style="color: #ffff00;">" $1 "</span>)
</pre>

</li>
</ul>
<ul>
<li id="sec-2-9-4-2">Mountbox<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Mountbox</span>
mymountbox = widget({ type = <span style="color: #ffff00;">"textbox"</span>, align=<span style="color: #ffff00;">"right"</span> })
pipelets.register_fmt( mymountbox, <span style="color: #ffff00;">"mmount"</span>, <span style="color: #ffff00;">" $1"</span>)
</pre>

</li>
</ul>
<ul>
<li id="sec-2-9-4-3">BatteryBox<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">BatteryBox</span>
mybatbox = widget({ type = <span style="color: #ffff00;">"textbox"</span>, align=<span style="color: #ffff00;">"right"</span> })
pipelets.register( mybatbox, <span style="color: #ffff00;">"batmon"</span>)
</pre>

</li>
</ul>
<ul>
<li id="sec-2-9-4-4">Temp<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Temp</span>
mytemp = widget({ type = <span style="color: #ffff00;">"textbox"</span>, align=<span style="color: #ffff00;">"right"</span> })
pipelets.register_fmt( mytemp, <span style="color: #ffff00;">"temp"</span>, <span style="color: #ffff00;">" $1 "</span>)
</pre>

</li>
</ul>
<ul>
<li id="sec-2-9-4-5">Layoutbox<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Layoutbox</span>
mylayoutbox = {}
mylayoutbox.buttons = awful.util.table.join(
   awful.button({ }, 1, <span style="color: #00ffff;">function</span> () 
                   awful.layout.inc(layouts, 1) 
                        <span style="color: #00ffff;">end</span>),
   awful.button({ }, 3, <span style="color: #00ffff;">function</span> () 
                   awful.layout.inc(layouts, -1) 
                        <span style="color: #00ffff;">end</span>),                
   awful.button({ }, 4, <span style="color: #00ffff;">function</span> () awful.layout.inc(layouts, 1) <span style="color: #00ffff;">end</span>),
   awful.button({ }, 5, <span style="color: #00ffff;">function</span> () awful.layout.inc(layouts, -1) <span style="color: #00ffff;">end</span>) 
                                           )
</pre>

</li>
</ul>
<ul>
<li id="sec-2-9-4-6">Taglist<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Taglist</span>
mytaglist = {}
mytaglist.buttons = awful.util.table.join(
   awful.button({ }, 1, awful.tag.viewonly),
   awful.button({ modkey }, 1, awful.client.movetotag),
   awful.button({ }, 3, <span style="color: #00ffff;">function</span> (tag) tag.selected = <span style="color: #00ffff;">not</span> tag.selected <span style="color: #00ffff;">end</span>),
   awful.button({ modkey }, 3, awful.client.toggletag),
   awful.button({ }, 4, awful.tag.viewnext),
   awful.button({ }, 5, awful.tag.viewprev) 
                                         )
</pre>

</li>
</ul>
<ul>
<li id="sec-2-9-4-7">Tasklist<br/>



<pre class="src src-lua">  <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Tasklist</span>
mytasklist = {}
mytasklist.buttons = awful.util.table.join(
   awful.button({ }, 1, <span style="color: #00ffff;">function</span> (c)
                   <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> c:isvisible() <span style="color: #00ffff;">then</span>
                      awful.tag.viewonly(c:tags()[1])
                   <span style="color: #00ffff;">end</span>
                   <span style="color: #00ffff;">if</span> client.focus ~= c <span style="color: #00ffff;">then</span> 
                      client.focus = c;
                   <span style="color: #00ffff;">end</span> 
                   client.focus:raise()
                        <span style="color: #00ffff;">end</span>),
   awful.button({ }, 3, <span style="color: #00ffff;">function</span> (c) 
                   <span style="color: #00ffff;">local</span> menu, coords = client_contex_menu(c)
                   menu_current(menu, {coords = coords})
                        <span style="color: #00ffff;">end</span>),
   awful.button({ }, 4, <span style="color: #00ffff;">function</span> ()
                   awful.client.focus.byidx(1)
                   <span style="color: #00ffff;">if</span> client.focus <span style="color: #00ffff;">then</span> client.focus:raise() <span style="color: #00ffff;">end</span>
                        <span style="color: #00ffff;">end</span>),
   awful.button({ }, 5, <span style="color: #00ffff;">function</span> ()
                   awful.client.focus.byidx(-1)
                   <span style="color: #00ffff;">if</span> client.focus <span style="color: #00ffff;">then</span> client.focus:raise() <span style="color: #00ffff;">end</span>
                        <span style="color: #00ffff;">end</span>) 
                                          )

</pre>

</li>
</ul>
</div>

</div>

<div id="outline-container-2-9-5" class="outline-4">
<h4 id="sec-2-9-5"><span class="section-number-4">2.9.5</span> Assemble it</h4>
<div class="outline-text-4" id="text-2-9-5">




<pre class="src src-lua"><span style="color: #00ffff;">for</span> s = 1, screen.count() <span style="color: #00ffff;">do</span>
   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Create a promptbox for each screen</span>
   mypromptbox[s] = awful.widget.prompt({layout = awful.widget.layout.horizontal.leftright})

   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Create an imagebox widget which will contains an icon indicating</span>
   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">which layout we're using. We need one layoutbox per screen.</span>
   mylayoutbox[s] = awful.widget.layoutbox(s)
   mylayoutbox[s]:buttons(mylayoutbox.buttons)

   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Create a taglist widget</span>
   mytaglist[s] = awful.widget.taglist(s, 
                                       awful.widget.taglist.label.all, 
                                       mytaglist.buttons)

   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Create a tasklist widget</span>
   mytasklist[s] = awful.widget.tasklist( <span style="color: #00ffff;">function</span> (c)
                                             <span style="color: #00ffff;">return</span> awful.widget.tasklist.label.currenttags(c,s)
                                          <span style="color: #00ffff;">end</span>, mytasklist.buttons)

   myclientmenu[s] = awful.widget.button({image = clientmenu_icon})
   myclientmenu[s]:buttons(myclientmenu.buttons)

   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">mykbd[s] = awful.widget.button({image = kbd_icon})</span>
   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">mykbd[s]:buttons(mykbd.buttons)</span>

   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Create top wibox</span>
   mytop[s] = awful.wibox({ 
                             position = <span style="color: #ffff00;">"top"</span>, screen = s, height = beautiful.wibox_height })
   mytop[s].widgets = {
      mylauncher,
      mylayoutbox[s],
      mytaglist[s],
      mypromptbox[s],
      {
         myclientmenu[s],
         s == 1 <span style="color: #00ffff;">and</span> mysystray <span style="color: #00ffff;">or</span> <span style="color: #00ffff;">nil</span>,
         mytextclock,
         layout = awful.widget.layout.horizontal.rightleft
      },
      mytasklist[s],
      layout = awful.widget.layout.horizontal.leftright,
      height = mytop[s].height
   }

   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Create bottom wibox</span>
   mybottom[s] = awful.wibox({ 
                                position = <span style="color: #ffff00;">"bottom"</span>, screen = s, height = beautiful.wibox_bottom_height })
   mybottom[s].widgets = {
      {
         <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">mykbdbox,</span>
         <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">mykbd[s],</span>
         layout = awful.widget.layout.horizontal.rightleft
      },
      <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">myrfkill,</span>
      mytemp,
      mybatbox,
      mymountbox,
      <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">mywifibox,</span>
      <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">mywimaxbox,</span>
      layout = awful.widget.layout.horizontal.leftright
   }
<span style="color: #00ffff;">end</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">}}}</span>
</pre>

</div>

</div>

<div id="outline-container-2-9-6" class="outline-4">
<h4 id="sec-2-9-6"><span class="section-number-4">2.9.6</span> Shifty initialize</h4>
<div class="outline-text-4" id="text-2-9-6">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">SHIFTY: initialize shifty</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">the assignment of shifty.taglist must always be after its actually</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">initialized with awful.widget.taglist.new()</span>
shifty.taglist = mytaglist
shifty.init()
</pre>

</div>
</div>

</div>

<div id="outline-container-2-10" class="outline-3">
<h3 id="sec-2-10"><span class="section-number-3">2.10</span> Mouse bindings</h3>
<div class="outline-text-3" id="text-2-10">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">{{{ Mouse bindings</span>
root.buttons(awful.util.table.join(
                awful.button({ }, 3, <span style="color: #00ffff;">function</span> () menu_current(mymainmenu) <span style="color: #00ffff;">end</span>),
                awful.button({ }, 4, awful.tag.viewnext),
                awful.button({ }, 5, awful.tag.viewprev)
                                  ))
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">}}}</span>
</pre>

</div>

</div>

<div id="outline-container-2-11" class="outline-3">
<h3 id="sec-2-11"><span class="section-number-3">2.11</span> Key bindings</h3>
<div class="outline-text-3" id="text-2-11">


</div>

<div id="outline-container-2-11-1" class="outline-4">
<h4 id="sec-2-11-1"><span class="section-number-4">2.11.1</span> Some functions</h4>
<div class="outline-text-4" id="text-2-11-1">

<ul>
<li id="sec-2-11-1-1">switch<sub>to</sub><sub>client</sub><br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">{{{ Key bindings</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Switches to prev/next client</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">switch_to_client</span>(direction)
   <span style="color: #00ffff;">if</span> direction == 0 <span style="color: #00ffff;">then</span>
      awful.client.focus.history.previous()
   <span style="color: #00ffff;">else</span>
      awful.client.focus.byidx(direction);  
   <span style="color: #00ffff;">end</span>
   <span style="color: #00ffff;">if</span> client.focus <span style="color: #00ffff;">then</span> client.focus:raise() <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-1-2">toggle<sub>tag</sub><br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Toggle tags between current and one, that has name @name</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">toggle_tag</span>(name)
   <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">this</span> = awful.tag.selected()
   <span style="color: #00ffff;">if</span> this.name == name <span style="color: #00ffff;">then</span>
      awful.tag.history.restore()
   <span style="color: #00ffff;">else</span>
      <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">t</span> = myrc.tagman.find(name)
      <span style="color: #00ffff;">if</span> t == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
         naughty.notify({text = <span style="color: #ffff00;">"Can't find tag with name '"</span> .. name .. <span style="color: #ffff00;">"'"</span>})
         <span style="color: #00ffff;">return</span>
      <span style="color: #00ffff;">end</span>
      awful.tag.viewonly(t)
   <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-1-3">chord<sub>mpd</sub><br/>



<pre class="src src-lua"><span style="color: #00ffff;">function</span> <span style="color: #4186be;">chord_mpd</span>()
   <span style="color: #00ffff;">return</span> {
      menu = {
         height = theme.menu_context_height
      },
      naughty = {
         title = <span style="color: #ffff00;">"::MPD::"</span>
      },

      {{}, <span style="color: #ffff00;">"Escape"</span>, <span style="color: #ffff00;">"Cancel"</span>, <span style="color: #00ffff;">function</span> () 
                               <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"w"</span>, <span style="color: #ffff00;">"Cancel"</span>, <span style="color: #00ffff;">function</span> () 
                          <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"p"</span>, <span style="color: #ffff00;">"Play/pause"</span>, <span style="color: #00ffff;">function</span> () 
          awful.util.spawn(<span style="color: #ffff00;">"mpc toggle"</span>, <span style="color: #00ffff;">false</span>)
                              <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"n"</span>, <span style="color: #ffff00;">"Next"</span>, <span style="color: #00ffff;">function</span> () 
          awful.util.spawn(<span style="color: #ffff00;">"mpc next"</span>, <span style="color: #00ffff;">false</span>)
                        <span style="color: #00ffff;">end</span>},

      {{<span style="color: #ffff00;">"Shift"</span>}, <span style="color: #ffff00;">"n"</span>, <span style="color: #ffff00;">"Prev"</span>, <span style="color: #00ffff;">function</span> () 
          awful.util.spawn(<span style="color: #ffff00;">"mpc prev"</span>, <span style="color: #00ffff;">false</span>)
                               <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"b"</span>, <span style="color: #ffff00;">"Back"</span>, <span style="color: #00ffff;">function</span> () 
          awful.util.spawn(<span style="color: #ffff00;">"mpc seek 0%"</span>, <span style="color: #00ffff;">false</span>)
                        <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"9"</span>, <span style="color: #ffff00;">"Vol down"</span>, <span style="color: #00ffff;">function</span> () 
          awful.util.spawn(<span style="color: #ffff00;">"mpc volume -5"</span>, <span style="color: #00ffff;">false</span>)
          <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">false</span>
                            <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"0"</span>, <span style="color: #ffff00;">"Vol up"</span>, <span style="color: #00ffff;">function</span> () 
          awful.util.spawn(<span style="color: #ffff00;">"mpc volume +5"</span>, <span style="color: #00ffff;">false</span>)
          <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">false</span>
                          <span style="color: #00ffff;">end</span>},
          }
<span style="color: #00ffff;">end</span>

</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-1-4">chord<sub>tags</sub><br/>



<pre class="src src-lua"><span style="color: #00ffff;">function</span> <span style="color: #4186be;">chord_tags</span>()
   <span style="color: #00ffff;">return</span> {
      menu = {
         height = theme.menu_context_height
      },
      naughty = {
         title = <span style="color: #ffff00;">"::TAGS::"</span>
      },
      {{}, <span style="color: #ffff00;">"Escape"</span>, <span style="color: #ffff00;">"Cancel"</span>, <span style="color: #00ffff;">function</span> () 
                               <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"Return"</span>, <span style="color: #ffff00;">"Cancel"</span>, <span style="color: #00ffff;">function</span> () 
                               <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"r"</span>, <span style="color: #ffff00;">"Rename current tag"</span>, <span style="color: #00ffff;">function</span> () 
          awful.prompt.run(
             { prompt = <span style="color: #ffff00;">"Rename this tag: "</span> }, 
             mypromptbox[mouse.screen].widget, 
             <span style="color: #00ffff;">function</span>(newname) 
                myrc.tagman.rename(awful.tag.selected(),newname) 
             <span style="color: #00ffff;">end</span>, 
             awful.completion.bash,
             awful.util.getdir(<span style="color: #ffff00;">"cache"</span>) .. <span style="color: #ffff00;">"/tag_rename"</span>)
                                      <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"c"</span>, <span style="color: #ffff00;">"Create new tag"</span>, <span style="color: #00ffff;">function</span> () 
          awful.prompt.run(
             { prompt = <span style="color: #ffff00;">"Create new tag: "</span> }, 
             mypromptbox[mouse.screen].widget, 
             <span style="color: #00ffff;">function</span>(newname) 
                <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">t</span> = myrc.tagman.add(newname) 
                myrc.tagman.move(t, myrc.tagman.next_to(awful.tag.selected())) 
             <span style="color: #00ffff;">end</span>, 
             awful.completion.bash,
             awful.util.getdir(<span style="color: #ffff00;">"cache"</span>) .. <span style="color: #ffff00;">"/tag_new"</span>)
                                  <span style="color: #00ffff;">end</span>},

      {{}, <span style="color: #ffff00;">"d"</span>, <span style="color: #ffff00;">"Delete current tag"</span>, <span style="color: #00ffff;">function</span> () 
          <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">sel</span> = awful.tag.selected()
          <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">def</span> = myrc.tagman.prev_to(sel)
          myrc.tagman.del(sel,def) 
          awful.tag.viewonly(def)
                                      <span style="color: #00ffff;">end</span>}, 

      {{}, <span style="color: #ffff00;">"k"</span>, <span style="color: #ffff00;">"Move tag right"</span>, <span style="color: #00ffff;">function</span> () 
          <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">sel</span> = awful.tag.selected()
          <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tgt</span> = myrc.tagman.next_to(sel)
          myrc.tagman.move(sel,tgt)
          <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">false</span>
                                  <span style="color: #00ffff;">end</span>}, 

      {{}, <span style="color: #ffff00;">"j"</span>, <span style="color: #ffff00;">"Move tag left"</span>, <span style="color: #00ffff;">function</span> () 
          <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">sel</span> = awful.tag.selected()
          <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tgt</span> = myrc.tagman.prev_to(sel)
          myrc.tagman.move(sel,tgt)
          <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">false</span>
                                 <span style="color: #00ffff;">end</span>}
          }
<span style="color: #00ffff;">end</span>
</pre>

</li>
</ul>
</div>

</div>

<div id="outline-container-2-11-2" class="outline-4">
<h4 id="sec-2-11-2"><span class="section-number-4">2.11.2</span> Global keys</h4>
<div class="outline-text-4" id="text-2-11-2">

<ul>
<li id="sec-2-11-2-1">Bind them<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Bind keyboard digits</span>
globalkeys = awful.util.table.join(
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-2">Main Menu<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Main menu</span>
awful.key({ altkey            }, <span style="color: #ffff00;">"Escape"</span>, <span style="color: #00ffff;">function</span>()  menu_current(mymainmenu,mainmenu_args) <span style="color: #00ffff;">end</span>),
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-3">Awesome control<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Awesome control</span>
awful.key({ modkey, <span style="color: #ffff00;">"Control"</span> }, <span style="color: #ffff00;">"q"</span>, awesome.quit),
awful.key({ modkey, <span style="color: #ffff00;">"Control"</span> }, <span style="color: #ffff00;">"r"</span>, <span style="color: #00ffff;">function</span>() mypromptbox[mouse.screen].widget.text = awful.util.escape(awful.util.restart()) <span style="color: #00ffff;">end</span>),
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-4">Application hotkeys<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Application hotkeys</span>
awful.key({ modkey,           }, <span style="color: #ffff00;">"Return"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(env.terminal) <span style="color: #00ffff;">end</span>),
awful.key({ modkey            }, <span style="color: #ffff00;">"b"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(env.browser) <span style="color: #00ffff;">end</span>),
awful.key({ modkey            }, <span style="color: #ffff00;">"e"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(env.email)  <span style="color: #00ffff;">end</span>),
awful.key({                   }, <span style="color: #ffff00;">"Scroll_Lock"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(env.locker) <span style="color: #00ffff;">end</span>),
awful.key({ modkey            }, <span style="color: #ffff00;">"r"</span>, <span style="color: #00ffff;">function</span> () mypromptbox[mouse.screen]:run() <span style="color: #00ffff;">end</span>),
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">awful.key({ modkey,           }, "m", function () run_or_raise("gmpc", { class = "Gmpc" }) end),</span>
awful.key({ modkey            }, <span style="color: #ffff00;">"p"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(<span style="color: #ffff00;">"pidgin"</span>) <span style="color: #00ffff;">end</span>),
awful.key({ modkey            }, <span style="color: #ffff00;">"c"</span>, <span style="color: #00ffff;">function</span> () run_or_raise(<span style="color: #ffff00;">"xterm -e calc"</span>, { class=<span style="color: #ffff00;">"XTerm"</span>, name = <span style="color: #ffff00;">"calc"</span> }) <span style="color: #00ffff;">end</span>),
awful.key({ modkey,           }, <span style="color: #ffff00;">"d"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(<span style="color: #ffff00;">"ec"</span>) <span style="color: #00ffff;">end</span>),
awful.key({ modkey,           }, <span style="color: #ffff00;">"v"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(env.volumecontrol) <span style="color: #00ffff;">end</span>),
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-5">Tag hotkeys<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Tag hotkeys</span>
awful.key({ modkey, <span style="color: #ffff00;">"Control"</span> }, <span style="color: #ffff00;">"m"</span>, <span style="color: #00ffff;">function</span> () toggle_tag(<span style="color: #ffff00;">"im"</span>) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Control"</span> }, <span style="color: #ffff00;">"w"</span>, <span style="color: #00ffff;">function</span> () toggle_tag(<span style="color: #ffff00;">"work"</span>) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Control"</span> }, <span style="color: #ffff00;">"n"</span>, <span style="color: #00ffff;">function</span> () toggle_tag(<span style="color: #ffff00;">"net"</span>) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Control"</span> }, <span style="color: #ffff00;">"f"</span>, <span style="color: #00ffff;">function</span> () toggle_tag(<span style="color: #ffff00;">"fun"</span>) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Control"</span> }, <span style="color: #ffff00;">"e"</span>, <span style="color: #00ffff;">function</span> () toggle_tag(<span style="color: #ffff00;">"sys"</span>) <span style="color: #00ffff;">end</span>),
awful.key({ modkey            }, <span style="color: #ffff00;">"Tab"</span>, <span style="color: #00ffff;">function</span>() awful.tag.history.restore() <span style="color: #00ffff;">end</span>),
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-6">Client manipulations<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Client manipulation</span>
awful.key({ altkey            }, <span style="color: #ffff00;">"j"</span>, <span style="color: #00ffff;">function</span> () switch_to_client(-1) <span style="color: #00ffff;">end</span>),
awful.key({ altkey            }, <span style="color: #ffff00;">"k"</span>, <span style="color: #00ffff;">function</span> () switch_to_client(1) <span style="color: #00ffff;">end</span>),
awful.key({ altkey            }, <span style="color: #ffff00;">"1"</span>, <span style="color: #00ffff;">function</span> () switch_to_client(-1) <span style="color: #00ffff;">end</span>),
awful.key({ altkey            }, <span style="color: #ffff00;">"2"</span>, <span style="color: #00ffff;">function</span> () switch_to_client(1) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Shift"</span>   }, <span style="color: #ffff00;">"j"</span>, <span style="color: #00ffff;">function</span> () awful.client.swap.byidx(1) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Shift"</span>   }, <span style="color: #ffff00;">"k"</span>, <span style="color: #00ffff;">function</span> () awful.client.swap.byidx(-1) <span style="color: #00ffff;">end</span>),
awful.key({ altkey            }, <span style="color: #ffff00;">"Tab"</span>, <span style="color: #00ffff;">function</span>() switch_to_client(0) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Shift"</span>   }, <span style="color: #ffff00;">"c"</span>,   <span style="color: #00ffff;">function</span> (c) c:kill() <span style="color: #00ffff;">end</span>),
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-7">Layout manipulation<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Layout manipulation</span>
awful.key({ altkey,           }, <span style="color: #ffff00;">"F1"</span>, awful.tag.viewprev ),
awful.key({ altkey,           }, <span style="color: #ffff00;">"F2"</span>, awful.tag.viewnext ),
awful.key({ modkey,           }, <span style="color: #ffff00;">"Left"</span>,   awful.tag.viewprev       ),
awful.key({ modkey,           }, <span style="color: #ffff00;">"Right"</span>,  awful.tag.viewnext       ),
awful.key({ modkey,           }, <span style="color: #ffff00;">"h"</span>, <span style="color: #00ffff;">function</span> () awful.tag.incmwfact(-0.05) <span style="color: #00ffff;">end</span>),
awful.key({ modkey,           }, <span style="color: #ffff00;">"l"</span>, <span style="color: #00ffff;">function</span> () awful.tag.incmwfact(0.05) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Shift"</span>   }, <span style="color: #ffff00;">"h"</span>, <span style="color: #00ffff;">function</span> () awful.tag.incnmaster(1) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Shift"</span>   }, <span style="color: #ffff00;">"l"</span>, <span style="color: #00ffff;">function</span> () awful.tag.incnmaster(-1) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Control"</span> }, <span style="color: #ffff00;">"h"</span>, <span style="color: #00ffff;">function</span> () awful.tag.incncol(1) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Control"</span> }, <span style="color: #ffff00;">"l"</span>, <span style="color: #00ffff;">function</span> () awful.tag.incncol(-1) <span style="color: #00ffff;">end</span>),
awful.key({ modkey,           }, <span style="color: #ffff00;">"space"</span>, <span style="color: #00ffff;">function</span> () awful.layout.inc(layouts, 1) <span style="color: #00ffff;">end</span>),
awful.key({ modkey, <span style="color: #ffff00;">"Shift"</span>   }, <span style="color: #ffff00;">"space"</span>, <span style="color: #00ffff;">function</span> () awful.layout.inc(layouts, -1) <span style="color: #00ffff;">end</span>),
awful.key({ altkey,           }, <span style="color: #ffff00;">"e"</span>, <span style="color: #00ffff;">function</span> () myrc.keybind.push_menu(chord_mpd(), chord_menu_args) <span style="color: #00ffff;">end</span>),
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-8">Multimedia keys<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Multimedia keys</span>
awful.key({ }, <span style="color: #ffff00;">"XF86AudioRaiseVolume"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(<span style="color: #ffff00;">"pactl -- set-sink-volume 0 +10%"</span>) <span style="color: #00ffff;">end</span>),
awful.key({ }, <span style="color: #ffff00;">"XF86AudioLowerVolume"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(<span style="color: #ffff00;">"pactl -- set-sink-volume 0 -10%"</span>) <span style="color: #00ffff;">end</span>),
awful.key({ }, <span style="color: #ffff00;">"XF86AudioMute"</span>, <span style="color: #00ffff;">function</span> () awful.util.spawn(<span style="color: #ffff00;">""</span>) <span style="color: #00ffff;">end</span>),
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-9">Tagset operations<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Tagset operations (Win+Ctrl+s,&lt;letter&gt; chords)</span>
awful.key({ altkey,           }, <span style="color: #ffff00;">"F3"</span>, <span style="color: #00ffff;">function</span> () myrc.keybind.push_menu(chord_tags(), chord_menu_args) <span style="color: #00ffff;">end</span>),
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-10">Shifty specific keybindings<br/>



<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Shifty: keybindings specific to shifty</span>
awful.key({modkey, <span style="color: #ffff00;">"Shift"</span>}, <span style="color: #ffff00;">"d"</span>, shifty.del), <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">delete a tag</span>
awful.key({modkey, <span style="color: #ffff00;">"Shift"</span>}, <span style="color: #ffff00;">"n"</span>, shifty.send_prev), <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">client to prev tag</span>
awful.key({modkey}, <span style="color: #ffff00;">"n"</span>, shifty.send_next), <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">client to next tag</span>
awful.key({modkey, <span style="color: #ffff00;">"Control"</span>}, <span style="color: #ffff00;">"n"</span>, <span style="color: #00ffff;">function</span>() shifty.tagtoscr(awful.util.cycle(screen.count(), mouse.screen + 1))  <span style="color: #00ffff;">end</span>), <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">move client to next tag</span>
awful.key({modkey, <span style="color: #ffff00;">"Shift"</span>}, <span style="color: #ffff00;">"a"</span>, shifty.add), <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">creat a new tag</span>
awful.key({modkey, <span style="color: #ffff00;">"Shift"</span>}, <span style="color: #ffff00;">"r"</span>, shifty.rename), <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">rename a tag</span>
awful.key({modkey, <span style="color: #ffff00;">"Shift"</span>}, <span style="color: #ffff00;">"a"</span>, <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">nopopup new tag</span>
   <span style="color: #00ffff;">function</span>()
      shifty.add({nopopup = <span style="color: #00ffff;">true</span>})
   <span style="color: #00ffff;">end</span>)
</pre>

</li>
</ul>
<ul>
<li id="sec-2-11-2-11">Set them<br/>



<pre class="src src-lua">)  
root.keys(globalkeys)
</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-2-11-3" class="outline-4">
<h4 id="sec-2-11-3"><span class="section-number-4">2.11.3</span> Client keys</h4>
<div class="outline-text-4" id="text-2-11-3">




<pre class="src src-lua">clientkeys = awful.util.table.join(
   awful.key({ modkey }, <span style="color: #ffff00;">"F1"</span>, <span style="color: #00ffff;">function</span> (c) 
                <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tag</span> = myrc.tagman.getn(-1)
                awful.client.movetotag(tag, c)
                awful.tag.viewonly(tag)
                c:raise()
                               <span style="color: #00ffff;">end</span>),
   awful.key({ modkey }, <span style="color: #ffff00;">"F2"</span>, <span style="color: #00ffff;">function</span> (c) 
                <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tag</span> = myrc.tagman.getn(1)
                awful.client.movetotag(tag, c)
                awful.tag.viewonly(tag)
                c:raise()
                               <span style="color: #00ffff;">end</span>),
   awful.key({ altkey }, <span style="color: #ffff00;">"F4"</span>, <span style="color: #00ffff;">function</span> (c) c:kill() <span style="color: #00ffff;">end</span>),
   awful.key({ altkey }, <span style="color: #ffff00;">"F5"</span>, <span style="color: #00ffff;">function</span> (c)
                c.maximized_horizontal = <span style="color: #00ffff;">not</span> c.maximized_horizontal
                c.maximized_vertical   = <span style="color: #00ffff;">not</span> c.maximized_vertical
                               <span style="color: #00ffff;">end</span>),

   awful.key({ altkey }, <span style="color: #ffff00;">"F6"</span>, <span style="color: #00ffff;">function</span> (c) dbg_client(c) <span style="color: #00ffff;">end</span>),

   <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Client keys</span>
   awful.key({ altkey ,        }, <span style="color: #ffff00;">"3"</span>, <span style="color: #00ffff;">function</span>(c) 
                <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">menu</span> = client_contex_menu(c)
                menu_current(menu, contextmenu_args)
                                       <span style="color: #00ffff;">end</span>)
                                  )

clientbuttons = awful.util.table.join(
   awful.button({ }, 1, <span style="color: #00ffff;">function</span> (c) client.focus = c; c:raise() <span style="color: #00ffff;">end</span>),
   awful.button({ modkey }, 1, awful.mouse.client.move),
   awful.button({ modkey }, 3, awful.mouse.client.resize)
                                     )
<span style="color: #ff0000;">--}}}</span>
</pre>


</div>

</div>

<div id="outline-container-2-11-4" class="outline-4">
<h4 id="sec-2-11-4"><span class="section-number-4">2.11.4</span> Shifty client keys</h4>
<div class="outline-text-4" id="text-2-11-4">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">SHIFTY: assign client keys to shifty for use in</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">match() function(manage hook)</span>
shifty.config.clientkeys = clientkeys
shifty.config.modkey = modkey
</pre>

</div>
</div>

</div>

<div id="outline-container-2-12" class="outline-3">
<h3 id="sec-2-12"><span class="section-number-3">2.12</span> Compute the maximum number of digit we need, limited to 9</h3>
<div class="outline-text-3" id="text-2-12">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Compute the maximum number of digit we need, limited to 9</span>
<span style="color: #00ffff;">for</span> i = 1, (shifty.config.maxtags <span style="color: #00ffff;">or</span> 9) <span style="color: #00ffff;">do</span>
    globalkeys = awful.util.table.join(globalkeys,
        awful.key({modkey}, i, <span style="color: #00ffff;">function</span>()
            <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">t</span> =  awful.tag.viewonly(shifty.getpos(i))
            <span style="color: #00ffff;">end</span>),
        awful.key({modkey, <span style="color: #ffff00;">"Control"</span>}, i, <span style="color: #00ffff;">function</span>()
            <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">t</span> = shifty.getpos(i)
            t.selected = <span style="color: #00ffff;">not</span> t.selected
            <span style="color: #00ffff;">end</span>),
        awful.key({modkey, <span style="color: #ffff00;">"Control"</span>, <span style="color: #ffff00;">"Shift"</span>}, i, <span style="color: #00ffff;">function</span>()
            <span style="color: #00ffff;">if</span> client.focus <span style="color: #00ffff;">then</span>
                awful.client.toggletag(shifty.getpos(i))
            <span style="color: #00ffff;">end</span>
            <span style="color: #00ffff;">end</span>),
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">move clients to other tags</span>
        awful.key({modkey, <span style="color: #ffff00;">"Shift"</span>}, i, <span style="color: #00ffff;">function</span>()
            <span style="color: #00ffff;">if</span> client.focus <span style="color: #00ffff;">then</span>
                t = shifty.getpos(i)
                awful.client.movetotag(t)
                awful.tag.viewonly(t)
            <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">end</span>))
    <span style="color: #00ffff;">end</span>
</pre>

</div>

</div>

<div id="outline-container-2-13" class="outline-3">
<h3 id="sec-2-13"><span class="section-number-3">2.13</span> Hooks</h3>
<div class="outline-text-3" id="text-2-13">




<pre class="src src-lua">  <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">{{{ Hooks</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Hook function to execute when focusing a client.</span>
client.add_signal(<span style="color: #ffff00;">"focus"</span>, <span style="color: #00ffff;">function</span> (c)
                     c.border_color = beautiful.border_focus
                           <span style="color: #00ffff;">end</span>)

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Hook function to execute when unfocusing a client.</span>
client.add_signal(<span style="color: #ffff00;">"unfocus"</span>, <span style="color: #00ffff;">function</span> (c)
                     c.border_color = beautiful.border_normal
                             <span style="color: #00ffff;">end</span>)

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Hook function to execute when a new client appears.</span>
client.add_signal(<span style="color: #ffff00;">"manage"</span>, <span style="color: #00ffff;">function</span> (c, startup)

                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">TODO: Handle menu closing on mouse movements</span>
                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">   c:add_signal("mouse::enter", function(c)</span>
                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">       function kill_mousemode_menu(m) </span>
                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">           if m and (true ~= m.keygrabber) then m:hide() end </span>
                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">       end</span>
                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">       kill_mousemode_menu(mymainmenu)</span>
                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">       kill_mousemode_menu(mycontextmenu)</span>
                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">   end)</span>

                     c:add_signal(<span style="color: #ffff00;">"mouse::enter"</span>, <span style="color: #00ffff;">function</span>(c)
                                     menu_hide()
                                                  <span style="color: #00ffff;">end</span>)

                     c:add_signal(<span style="color: #ffff00;">"property::floating"</span>, <span style="color: #00ffff;">function</span>(c) 
                                     c.border_width = get_layout_border(c)
                                                        <span style="color: #00ffff;">end</span>)

                     <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">name</span> = client_name(c)
                     <span style="color: #00ffff;">if</span> c.type == <span style="color: #ffff00;">"dialog"</span> <span style="color: #00ffff;">then</span> 
                        save_snap(c, <span style="color: #ffff00;">'center'</span>)
                     <span style="color: #00ffff;">end</span>

                     <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tag</span> = get_tag(c, <span style="color: #00ffff;">nil</span>)
                     <span style="color: #00ffff;">if</span> tag ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
                        awful.client.movetotag(tag, c)
                     <span style="color: #00ffff;">end</span>

                     <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">floating</span> = myrc.memory.get(<span style="color: #ffff00;">"floating"</span>, name)
                     <span style="color: #00ffff;">if</span> floating ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span> 
                        awful.client.floating.set(c, floating)
                     <span style="color: #00ffff;">else</span>
                        floating = awful.client.floating.get(c)
                     <span style="color: #00ffff;">end</span>

                     <span style="color: #00ffff;">if</span> floating == <span style="color: #00ffff;">true</span> <span style="color: #00ffff;">then</span>
                        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">dock</span> = get_dockable(c, <span style="color: #00ffff;">nil</span>)
                        <span style="color: #00ffff;">if</span> dock ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
                           awful.client.dockable.set(c, dock)
                        <span style="color: #00ffff;">end</span>
                        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">geom</span> = myrc.memory.get(<span style="color: #ffff00;">"geometry"</span>, name)
                        <span style="color: #00ffff;">if</span> geom ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
                           c:geometry(geom)
                        <span style="color: #00ffff;">end</span>
                        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">maxhor</span> = get_hor(c, <span style="color: #00ffff;">nil</span>)
                        <span style="color: #00ffff;">if</span> maxhor ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
                           c.maximized_horizontal = maxhor
                        <span style="color: #00ffff;">end</span>
                        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">maxvert</span> = get_vert(c, <span style="color: #00ffff;">nil</span>)
                        <span style="color: #00ffff;">if</span> maxvert ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
                           c.maximized_vertical = maxvert
                        <span style="color: #00ffff;">end</span>
                        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">snap</span> = get_snap(c, <span style="color: #00ffff;">nil</span>)
                        <span style="color: #00ffff;">if</span> snap ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
                           client_snap(c, snap, geom)
                        <span style="color: #00ffff;">end</span>
                     <span style="color: #00ffff;">end</span>

                     <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">hidme</span> = get_hidden(c, <span style="color: #00ffff;">nil</span>)
                     <span style="color: #00ffff;">if</span> hidme ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
                        c.skip_taskbar = hidme
                     <span style="color: #00ffff;">end</span>

                     <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">titlebar</span> = get_titlebar(c,<span style="color: #00ffff;">nil</span>)
                     <span style="color: #00ffff;">if</span> titlebar == <span style="color: #00ffff;">true</span> <span style="color: #00ffff;">then</span>
                        awful.titlebar.add(c, { modkey = modkey })
                     <span style="color: #00ffff;">else</span>
                        awful.titlebar.remove(c)
                     <span style="color: #00ffff;">end</span>

                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Set key bindings</span>
                     c:buttons(clientbuttons)
                     c:keys(clientkeys)

                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Set default app icon</span>
                     <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> c.icon <span style="color: #00ffff;">and</span> theme.default_client_icon <span style="color: #00ffff;">then</span>
                        c.icon = image(theme.default_client_icon)
                     <span style="color: #00ffff;">end</span>

                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">New client may not receive focus</span>
                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">if they're not focusable, so set border anyway.</span>
                     c.border_width = get_layout_border(c)
                     c.border_color = beautiful.border_normal
                     c.size_hints_honor = <span style="color: #00ffff;">false</span>

                     <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> c.skip_taskbar <span style="color: #00ffff;">then</span>
                        client.focus = c
                     <span style="color: #00ffff;">end</span>

                     <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">XVkbd hack</span>
                     <span style="color: #00ffff;">if</span> c.class == <span style="color: #ffff00;">"XVkbd"</span> <span style="color: #00ffff;">then</span>
                        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">sg</span> = screen[1].geometry
                        c.maximized_horizontal = sg.height &gt; sg.width
                     <span style="color: #00ffff;">end</span>
                            <span style="color: #00ffff;">end</span>)

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Signal from tagman lib. </span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Handler will store tag names to registry.</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Those names will be used at next awesome start</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">to recreate current tags.</span>
awesome.add_signal(<span style="color: #ffff00;">"tagman::update"</span>, <span style="color: #00ffff;">function</span> (t, s) 
                      myrc.memory.set(<span style="color: #ffff00;">"tagnames"</span>, tostring(s), myrc.tagman.names())
                                     <span style="color: #00ffff;">end</span>)

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Will change border width for max layout</span>
<span style="color: #00ffff;">for</span> s = 1, screen.count() <span style="color: #00ffff;">do</span>
   awful.tag.attached_add_signal(s,<span style="color: #ffff00;">"property::layout"</span>, <span style="color: #00ffff;">function</span>()
                                    <span style="color: #00ffff;">for</span> _,c <span style="color: #00ffff;">in</span> pairs(awful.tag.selected():clients()) <span style="color: #00ffff;">do</span>
                                       c.border_width = get_layout_border(c)
                                    <span style="color: #00ffff;">end</span>
                                                       <span style="color: #00ffff;">end</span>)
<span style="color: #00ffff;">end</span>
</pre>

</div>

</div>

<div id="outline-container-2-14" class="outline-3">
<h3 id="sec-2-14"><span class="section-number-3">2.14</span> Autostart</h3>
<div class="outline-text-3" id="text-2-14">




<pre class="src src-lua">awful.util.spawn_with_shell(<span style="color: #ffff00;">"~/.config/awesome/autostart.sh"</span>)
</pre>


</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> freedesktop</h2>
<div class="outline-text-2" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> desktop.lua</h3>
<div class="outline-text-3" id="text-3-1">




<pre class="src src-lua"><span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">wibox</span> = wibox
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">widget</span> = widget
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">screen</span> = screen
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">image</span> = image
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">button</span> = button
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">table</span> = table
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">ipairs</span> = ipairs
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awful</span> = require(<span style="color: #ffff00;">"awful"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">utils</span> = require(<span style="color: #ffff00;">"freedesktop.utils"</span>)

module(<span style="color: #ffff00;">"freedesktop.desktop"</span>)

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">current_pos</span> = {}
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">iconsize</span> = { width = 48, height = 48 }
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">labelsize</span> = { width = 100, height = 20 }
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">margin</span> = { x = 20, y = 20 }

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">add_icon</span>(settings)

    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">s</span> = settings.screen

    <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> current_pos[s] <span style="color: #00ffff;">then</span>
        current_pos[s] = { x = (screen[s].geometry.width - iconsize.width - margin.x), y = 40 }
    <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">totheight</span> = (settings.icon <span style="color: #00ffff;">and</span> iconsize.height <span style="color: #00ffff;">or</span> 0) + (settings.label <span style="color: #00ffff;">and</span> labelsize.height <span style="color: #00ffff;">or</span> 0)
    <span style="color: #00ffff;">if</span> totheight == 0 <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">if</span> current_pos[s].y + totheight &gt; screen[s].geometry.height - 40 <span style="color: #00ffff;">then</span>
        current_pos[s].x = current_pos[s].x - labelsize.width - iconsize.width - margin.x
        current_pos[s].y = 40
    <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">if</span> (settings.icon) <span style="color: #00ffff;">then</span>
        icon = awful.widget.button({ image = settings.icon })
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">newbuttons</span> = icon:buttons()
        table.insert(newbuttons, button({}, 1, <span style="color: #00ffff;">nil</span>, settings.click));
        icon:buttons(newbuttons)

        icon_container = wibox({ position = <span style="color: #ffff00;">"floating"</span>, screen = s, bg = <span style="color: #ffff00;">"#00000000"</span> })
        icon_container.widgets = { icon }
        icon_container:geometry({
            width = iconsize.width,
            height = iconsize.height,
            y = current_pos[s].y,
            x = current_pos[s].x
        })
        icon_container.screen = s

        current_pos[s].y = current_pos[s].y + iconsize.height + 5
    <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">if</span> (settings.label) <span style="color: #00ffff;">then</span>
        caption = widget({ type=<span style="color: #ffff00;">"textbox"</span>, align=<span style="color: #ffff00;">"right"</span> })
        caption.text = settings.label
        caption:buttons({
            button({ }, 1, settings.click)
        })

        caption_container = wibox({ position = <span style="color: #ffff00;">"floating"</span>, screen = s, bg = <span style="color: #ffff00;">"#00000000"</span> })
        caption_container.widgets = { caption }
        caption_container:geometry({
            width = labelsize.width,
            height = labelsize.height,
            y = current_pos[s].y,
            x = current_pos[s].x - labelsize.width + iconsize.width
        })
        caption_container.screen = s
    <span style="color: #00ffff;">end</span>

    current_pos[s].y = current_pos[s].y + labelsize.height + margin.y
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">add_desktop_icons</span>(arg)
    <span style="color: #00ffff;">for</span> i, program <span style="color: #00ffff;">in</span> ipairs(utils.parse_dir(<span style="color: #ffff00;">'~/Desktop'</span>,
        { iconsize.width .. <span style="color: #ffff00;">"x"</span> .. iconsize.height,
        <span style="color: #ffff00;">"128x128"</span>, <span style="color: #ffff00;">"96x96"</span>, <span style="color: #ffff00;">"72x72"</span>, <span style="color: #ffff00;">"64x64"</span>, <span style="color: #ffff00;">"48x48"</span>,
        <span style="color: #ffff00;">"36x36"</span>, <span style="color: #ffff00;">"32x32"</span>, <span style="color: #ffff00;">"24x24"</span>, <span style="color: #ffff00;">"22x22"</span>, <span style="color: #ffff00;">"16x16"</span> })) <span style="color: #00ffff;">do</span>
        <span style="color: #00ffff;">if</span> program.show <span style="color: #00ffff;">then</span>
            add_icon({
                label = arg.showlabels <span style="color: #00ffff;">and</span> program.Name <span style="color: #00ffff;">or</span> <span style="color: #00ffff;">nil</span>,
                icon = program.icon_path,
                screen = arg.screen,
                <span style="color: #4186be;">click</span> = <span style="color: #00ffff;">function</span> () awful.util.spawn(program.cmdline) <span style="color: #00ffff;">end</span>
            })
        <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>
</pre>

</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> menu.lua</h3>
<div class="outline-text-3" id="text-3-2">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Grab environment</span>
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">utils</span> = require(<span style="color: #ffff00;">"freedesktop.utils"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">io</span> = io
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">ipairs</span> = ipairs
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">table</span> = table
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">os</span> = os

module(<span style="color: #ffff00;">"freedesktop.menu"</span>)

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">new</span>()
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">the categories and their synonyms where shamelessly copied from lxpanel</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">source code.</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">programs</span> = {}
        programs[<span style="color: #ffff00;">'AudioVideo'</span>] = {}
        <span style="color: #ff0000;">--programs['Audio'] = {}</span>
        <span style="color: #ff0000;">--programs['Video'] = {}</span>
        programs[<span style="color: #ffff00;">'Development'</span>] = {}
        <span style="color: #ff0000;">--programs['Education'] = {}</span>
        <span style="color: #ff0000;">--programs['Game'] = {}</span>
        programs[<span style="color: #ffff00;">'Graphics'</span>] = {}
        programs[<span style="color: #ffff00;">'Network'</span>] = {}
        programs[<span style="color: #ffff00;">'Office'</span>] = {}
        <span style="color: #ff0000;">--programs['Settings'] = {}</span>
        programs[<span style="color: #ffff00;">'System'</span>] = {}
        programs[<span style="color: #ffff00;">'Utility'</span>] = {}
        programs[<span style="color: #ffff00;">'Other'</span>] = {}


        <span style="color: #00ffff;">for</span> i, program <span style="color: #00ffff;">in</span> ipairs(utils.parse_dir(<span style="color: #ffff00;">'/usr/share/applications/'</span>)) <span style="color: #00ffff;">do</span>

                <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">check whether to include in the menu</span>
                <span style="color: #00ffff;">if</span> program.show <span style="color: #00ffff;">and</span> program.Name <span style="color: #00ffff;">and</span> program.cmdline <span style="color: #00ffff;">then</span>
                        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">target_category</span> = <span style="color: #00ffff;">nil</span>
                        <span style="color: #00ffff;">if</span> program.categories <span style="color: #00ffff;">then</span>
                                <span style="color: #00ffff;">for</span> _, category <span style="color: #00ffff;">in</span> ipairs(program.categories) <span style="color: #00ffff;">do</span>
                                        <span style="color: #00ffff;">if</span> programs[category] <span style="color: #00ffff;">then</span>
                                                target_category = category
                                                <span style="color: #00ffff;">break</span>
                                        <span style="color: #00ffff;">end</span>
                                <span style="color: #00ffff;">end</span>
                        <span style="color: #00ffff;">end</span>
                        <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> target_category <span style="color: #00ffff;">then</span>
                                target_category = <span style="color: #ffff00;">'Other'</span>
                        <span style="color: #00ffff;">end</span>
                        <span style="color: #00ffff;">if</span> target_category <span style="color: #00ffff;">then</span>
                                table.insert(programs[target_category], { program.Name, program.cmdline, program.icon_path })
                        <span style="color: #00ffff;">end</span>
                <span style="color: #00ffff;">end</span>

        <span style="color: #00ffff;">end</span>

        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">menu</span> = {
                { <span style="color: #ffff00;">"&amp;A Accessories"</span>, programs[<span style="color: #ffff00;">"Utility"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-accessories.png'</span> }) },
                { <span style="color: #ffff00;">"&amp;D Development"</span>, programs[<span style="color: #ffff00;">"Development"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-development.png'</span> }) },
                { <span style="color: #ffff00;">"&amp;U Education"</span>, programs[<span style="color: #ffff00;">"Education"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-science.png'</span> }) },
                { <span style="color: #ffff00;">"Games"</span>, programs[<span style="color: #ffff00;">"Game"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-games.png'</span> }) },
                { <span style="color: #ffff00;">"&amp;G Graphics"</span>, programs[<span style="color: #ffff00;">"Graphics"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-graphics.png'</span> }) },
                { <span style="color: #ffff00;">"&amp;I Internet"</span>, programs[<span style="color: #ffff00;">"Network"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-internet.png'</span> }) },
                { <span style="color: #ffff00;">"&amp;M Multimedia"</span>, programs[<span style="color: #ffff00;">"AudioVideo"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-multimedia.png'</span> }) },
                { <span style="color: #ffff00;">"&amp;C Office"</span>, programs[<span style="color: #ffff00;">"Office"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-office.png'</span> }) },
                { <span style="color: #ffff00;">"&amp;H Other"</span>, programs[<span style="color: #ffff00;">"Other"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-other.png'</span> }) },
                { <span style="color: #ffff00;">"Settings"</span>, programs[<span style="color: #ffff00;">"Settings"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-utilities.png'</span> }) },
                { <span style="color: #ffff00;">"&amp;T System Tools"</span>, programs[<span style="color: #ffff00;">"System"</span>], utils.lookup_icon({ icon = <span style="color: #ffff00;">'applications-system.png'</span> }) },
        }

        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Removing empty entries from menu</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">bad_indexes</span> = {}
        <span style="color: #00ffff;">for</span> index , item <span style="color: #00ffff;">in</span> ipairs(menu) <span style="color: #00ffff;">do</span>
                <span style="color: #00ffff;">if</span> <span style="color: #00ffff;">not</span> item[2] <span style="color: #00ffff;">then</span>
                        table.insert(bad_indexes, index)
                <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">end</span>
        table.sort(bad_indexes, <span style="color: #00ffff;">function</span> (a,b) <span style="color: #00ffff;">return</span> a &gt; b <span style="color: #00ffff;">end</span>)
        <span style="color: #00ffff;">for</span> _, index <span style="color: #00ffff;">in</span> ipairs(bad_indexes) <span style="color: #00ffff;">do</span>
                table.remove(menu, index)
        <span style="color: #00ffff;">end</span>

        <span style="color: #00ffff;">return</span> menu
<span style="color: #00ffff;">end</span>
</pre>

</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> utils.lua</h3>
<div class="outline-text-3" id="text-3-3">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Grab environment</span>

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">io</span> = io
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">table</span> = table
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">ipairs</span> = ipairs

module(<span style="color: #ffff00;">"freedesktop.utils"</span>)

terminal = <span style="color: #ffff00;">'xterm'</span>

default_icon = <span style="color: #ffff00;">''</span>

icon_theme = <span style="color: #00ffff;">nil</span>

all_icon_sizes = { 
        <span style="color: #ffff00;">'128x128'</span> ,
        <span style="color: #ffff00;">'96x96'</span>, 
        <span style="color: #ffff00;">'72x72'</span>, 
        <span style="color: #ffff00;">'64x64'</span>, 
        <span style="color: #ffff00;">'48x48'</span>, 
        <span style="color: #ffff00;">'36x36'</span>, 
        <span style="color: #ffff00;">'32x32'</span>, 
        <span style="color: #ffff00;">'24x24'</span>, 
        <span style="color: #ffff00;">'22x22'</span>, 
        <span style="color: #ffff00;">'16x16'</span> 
}

icon_sizes = {}

<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">file_exists</span>(filename)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">file</span> = io.open(filename, <span style="color: #ffff00;">'r'</span>)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">result</span> = (file ~= <span style="color: #00ffff;">nil</span>)
    <span style="color: #00ffff;">if</span> result <span style="color: #00ffff;">then</span>
        file:close()
    <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">return</span> result
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">lookup_icon</span>(arg)
    <span style="color: #00ffff;">if</span> arg.icon:sub(1, 1) == <span style="color: #ffff00;">'/'</span> <span style="color: #00ffff;">and</span> (arg.icon:find(<span style="color: #ffff00;">'.+%.png'</span>) <span style="color: #00ffff;">or</span> arg.icon:find(<span style="color: #ffff00;">'.+%.xpm'</span>)) <span style="color: #00ffff;">then</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">icons with absolute path and supported (AFAICT) formats</span>
        <span style="color: #00ffff;">return</span> arg.icon
    <span style="color: #00ffff;">else</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">icon_path</span> = {}
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">icon_theme_paths</span> = {}
        <span style="color: #00ffff;">if</span> icon_theme <span style="color: #00ffff;">then</span>
            table.insert(icon_theme_paths, <span style="color: #ffff00;">'/usr/share/icons/'</span> .. icon_theme .. <span style="color: #ffff00;">'/'</span>)
            <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">TODO also look in parent icon themes, as in freedesktop.org specification</span>
        <span style="color: #00ffff;">end</span>
        table.insert(icon_theme_paths, <span style="color: #ffff00;">'/usr/share/icons/hicolor/'</span>) <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">fallback theme cf spec</span>

                <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">isizes</span> = icon_sizes
        <span style="color: #00ffff;">for</span> i, sz <span style="color: #00ffff;">in</span> ipairs(all_icon_sizes) <span style="color: #00ffff;">do</span>
                        table.insert(isizes, sz)
                <span style="color: #00ffff;">end</span>

        <span style="color: #00ffff;">for</span> i, icon_theme_directory <span style="color: #00ffff;">in</span> ipairs(icon_theme_paths) <span style="color: #00ffff;">do</span>
            <span style="color: #00ffff;">for</span> j, size <span style="color: #00ffff;">in</span> ipairs(arg.icon_sizes <span style="color: #00ffff;">or</span> isizes) <span style="color: #00ffff;">do</span>
                table.insert(icon_path, icon_theme_directory .. size .. <span style="color: #ffff00;">'/apps/'</span>)
                table.insert(icon_path, icon_theme_directory .. size .. <span style="color: #ffff00;">'/actions/'</span>)
                table.insert(icon_path, icon_theme_directory .. size .. <span style="color: #ffff00;">'/devices/'</span>)
                table.insert(icon_path, icon_theme_directory .. size .. <span style="color: #ffff00;">'/places/'</span>)
                table.insert(icon_path, icon_theme_directory .. size .. <span style="color: #ffff00;">'/categories/'</span>)
                table.insert(icon_path, icon_theme_directory .. size .. <span style="color: #ffff00;">'/status/'</span>)
            <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">end</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">lowest priority fallbacks</span>
        table.insert(icon_path,  <span style="color: #ffff00;">'/usr/share/pixmaps/'</span>)
        table.insert(icon_path,  <span style="color: #ffff00;">'/usr/share/icons/'</span>)

        <span style="color: #00ffff;">for</span> i, directory <span style="color: #00ffff;">in</span> ipairs(icon_path) <span style="color: #00ffff;">do</span>
            <span style="color: #00ffff;">if</span> (arg.icon:find(<span style="color: #ffff00;">'.+%.png'</span>) <span style="color: #00ffff;">or</span> arg.icon:find(<span style="color: #ffff00;">'.+%.xpm'</span>)) <span style="color: #00ffff;">and</span> file_exists(directory .. arg.icon) <span style="color: #00ffff;">then</span>
                <span style="color: #00ffff;">return</span> directory .. arg.icon
            <span style="color: #00ffff;">elseif</span> file_exists(directory .. arg.icon .. <span style="color: #ffff00;">'.xpm'</span>) <span style="color: #00ffff;">then</span>
                <span style="color: #00ffff;">return</span> directory .. arg.icon .. <span style="color: #ffff00;">'.xpm'</span>
            <span style="color: #00ffff;">elseif</span> file_exists(directory .. arg.icon .. <span style="color: #ffff00;">'.png'</span>) <span style="color: #00ffff;">then</span>
                <span style="color: #00ffff;">return</span> directory .. arg.icon .. <span style="color: #ffff00;">'.png'</span>
            <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">return</span> default_icon
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">--- Parse a .desktop file</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@param file The .desktop file</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@param requested_icon_sizes A list of icon sizes (optional). If this list is given, it will be used as a priority list for icon sizes when looking up for icons. If you want large icons, for example, you can put '128x128' as the first item in the list.</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@return A table with file entries.</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">parse</span>(file, requested_icon_sizes)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">program</span> = { show = <span style="color: #00ffff;">true</span>, file = file }
    <span style="color: #00ffff;">for</span> line <span style="color: #00ffff;">in</span> io.lines(file) <span style="color: #00ffff;">do</span>
        <span style="color: #00ffff;">for</span> key, value <span style="color: #00ffff;">in</span> line:gmatch(<span style="color: #ffff00;">"(%w+)=(.+)"</span>) <span style="color: #00ffff;">do</span>
            program[key] = value
        <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">end</span>

    <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Only show the program if there is not OnlyShowIn attribute</span>
    <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">or if it's equal to 'awesome'</span>
    <span style="color: #00ffff;">if</span> program.OnlyShowIn ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">and</span> program.OnlyShowIn ~= <span style="color: #ffff00;">"awesome"</span> <span style="color: #00ffff;">then</span>
        program.show = <span style="color: #00ffff;">false</span>
    <span style="color: #00ffff;">end</span>

    <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Look up for a icon.</span>
    <span style="color: #00ffff;">if</span> program.Icon <span style="color: #00ffff;">then</span>
        program.icon_path = lookup_icon({ icon = program.Icon, icon_sizes = (requested_icon_sizes <span style="color: #00ffff;">or</span> all_icon_sizes) })
    <span style="color: #00ffff;">end</span>

    <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Split categories into a table.</span>
    <span style="color: #00ffff;">if</span> program.Categories <span style="color: #00ffff;">then</span>
        program.categories = {}
        <span style="color: #00ffff;">for</span> category <span style="color: #00ffff;">in</span> program.Categories:gfind(<span style="color: #ffff00;">'[^;]+'</span>) <span style="color: #00ffff;">do</span>
            table.insert(program.categories, category)
        <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">if</span> program.Exec <span style="color: #00ffff;">then</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">cmdline</span> = program.Exec:gsub(<span style="color: #ffff00;">'%%c'</span>, program.Name)
        cmdline = cmdline:gsub(<span style="color: #ffff00;">'%%[fuFU]'</span>, <span style="color: #ffff00;">''</span>)
        cmdline = cmdline:gsub(<span style="color: #ffff00;">'%%k'</span>, program.file)
        <span style="color: #00ffff;">if</span> program.icon_path <span style="color: #00ffff;">then</span>
            cmdline = cmdline:gsub(<span style="color: #ffff00;">'%%i'</span>, <span style="color: #ffff00;">'--icon '</span> .. program.icon_path)
        <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">if</span> program.Terminal == <span style="color: #ffff00;">"true"</span> <span style="color: #00ffff;">then</span>
            cmdline = terminal .. <span style="color: #ffff00;">' -e '</span> .. cmdline
        <span style="color: #00ffff;">end</span>
        program.cmdline = cmdline
    <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">return</span> program
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">--- Parse a directory with .desktop files</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@param dir The directory.</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@param icons_size, The icons sizes, optional.</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@return A table with all .desktop entries.</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">parse_dir</span>(dir, icon_sizes)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">programs</span> = {}
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">files</span> = io.popen(<span style="color: #ffff00;">'find '</span>.. dir ..<span style="color: #ffff00;">' -maxdepth 1 -name "*.desktop"'</span>):lines()
    <span style="color: #00ffff;">for</span> file <span style="color: #00ffff;">in</span> files <span style="color: #00ffff;">do</span>
        table.insert(programs, parse(file, icon_sizes))
    <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">return</span> programs
<span style="color: #00ffff;">end</span>
</pre>

</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> myrc</h2>
<div class="outline-text-2" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> mainmenu.lua</h3>
<div class="outline-text-3" id="text-4-1">




<pre class="src src-lua"><span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awful</span> = require(<span style="color: #ffff00;">"awful"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">beautiful</span> = require(<span style="color: #ffff00;">"beautiful"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">freedesktop_utils</span> = require(<span style="color: #ffff00;">"freedesktop.utils"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">freedesktop_menu</span> = require(<span style="color: #ffff00;">"freedesktop.menu"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">themes</span> = require(<span style="color: #ffff00;">"myrc.themes"</span>)

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">io</span> = io
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">table</span> = table
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awesome</span> = awesome
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">ipairs</span> = ipairs
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">os</span> = os
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">string</span> = string
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">mouse</span> = mouse

module(<span style="color: #ffff00;">"myrc.mainmenu"</span>)

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">env</span> = {}

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Reserved.</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">init</span>(enviroment)
    env = enviroment
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Creates main menu</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Note: Uses beautiful.icon_theme and beautiful.icon_theme_size</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">env - table with string constants - command line to different apps</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">build</span>()
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">terminal</span> = (env.terminal <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"xterm"</span>) .. <span style="color: #ffff00;">" "</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">man</span> = (env.man <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"xterm -e man"</span>) .. <span style="color: #ffff00;">" "</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">editor</span> = (env.editor <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"xterm -e "</span> .. (os.getenv(<span style="color: #ffff00;">"EDITOR"</span>) <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"vim"</span>)) .. <span style="color: #ffff00;">" "</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">browser</span> = (env.browser <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"firefox"</span>) .. <span style="color: #ffff00;">" "</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">run</span> = (env.run <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"gmrun"</span>)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">fileman</span> = env.fileman <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"xterm -e mc"</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">xkill</span> = env.xkill <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"xkill"</span> .. <span style="color: #ffff00;">" "</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">poweroff</span> = env.poweroff <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"sudo /sbin/poweroff"</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">reboot</span> = env.reboot <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"sudo /sbin/reboot"</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">rotate</span> = env.rotate <span style="color: #00ffff;">or</span> <span style="color: #00ffff;">nil</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">logout</span> = env.logout <span style="color: #00ffff;">or</span> awesome.quit
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">suspend</span> = env.suspend <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"sudo /usr/sbin/pm-suspend"</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">hibernate</span> = env.hibernate <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"sudo /usr/sbin/pm-hibernate"</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">syslog</span> = env.syslog <span style="color: #00ffff;">or</span> terminal .. <span style="color: #ffff00;">" -e vim /var/log/messages"</span>

    freedesktop_utils.terminal = terminal
    freedesktop_utils.icon_theme = beautiful.icon_theme 
    freedesktop_utils.icon_sizes = {beautiful.icon_theme_size}
    freedesktop_utils.default_icon = beautiful.default_client_icon 

        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">myquitmenu</span> = {
        { <span style="color: #ffff00;">"&amp;Poweroff"</span>, poweroff, freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">'system-shutdown'</span> })}, 
        { <span style="color: #ffff00;">"&amp;Reboot"</span>, reboot, freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">'system-shutdown'</span> })}, 
        { <span style="color: #ffff00;">"H&amp;ibernate"</span>, hibernate, freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">'system-shutdown'</span> }) }, 
        { <span style="color: #ffff00;">"&amp;Suspend"</span>, suspend, freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">'system-shutdown'</span> }) }, 
        { <span style="color: #ffff00;">"&amp;Logout"</span>, logout , freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">'gnome-logout'</span> })}, 
        }

    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">myawesomemenu</span> = { 
        { <span style="color: #ffff00;">"&amp;Themes"</span>, themes.menu(), 
            freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">'wallpaper'</span> }) }, 
        { <span style="color: #ffff00;">"&amp;Restart"</span>, awesome.restart, freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">'reload'</span> }) },
        { <span style="color: #ffff00;">"&amp;Stop"</span>, awesome.quit, freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">'stop'</span> }) } 
    }

    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">mymainmenu_items_head</span> = {
        { <span style="color: #ffff00;">"Awesome"</span>, myawesomemenu, beautiful.awesome_icon },
        { <span style="color: #ffff00;">"&amp;E Terminal"</span>, terminal, freedesktop_utils.lookup_icon({icon = <span style="color: #ffff00;">'terminal'</span>}) },
        { <span style="color: #ffff00;">"&amp;F File Manager"</span>, fileman, freedesktop_utils.lookup_icon({icon = <span style="color: #ffff00;">'file-manager'</span>}) },
        { <span style="color: #ffff00;">"&amp;B Browser"</span>, browser, freedesktop_utils.lookup_icon({icon = <span style="color: #ffff00;">'browser'</span>}) },
        { <span style="color: #ffff00;">""</span>, <span style="color: #00ffff;">nil</span>, <span style="color: #00ffff;">nil</span>}, <span style="color: #ff0000;">--separator</span>
    }

    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">mymainmenu_items_tail</span> = {
        { <span style="color: #ffff00;">""</span>, <span style="color: #00ffff;">nil</span>, <span style="color: #00ffff;">nil</span>}, <span style="color: #ff0000;">--separator</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">{ "&amp;S Syslog", syslog, freedesktop_utils.lookup_icon({ icon = "gnome-monitor"}) },</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">{ "&amp;O Rotate", {</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">    {"&amp;Normal", rotate .. " normal" , freedesktop_utils.lookup_icon({icon = 'stock_down'})},</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">    {"&amp;Left",   rotate .. " left"   , freedesktop_utils.lookup_icon({icon = 'stock_left'})},</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">    {"&amp;Rigth",  rotate .. " right"  , freedesktop_utils.lookup_icon({icon = 'stock_right'})},</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">}, freedesktop_utils.lookup_icon({icon = 'reload'})},</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">{ "&amp;W Wifi", {</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">    {"&amp;F Wifi", env.rfkill.wifi , freedesktop_utils.lookup_icon({icon = 'stock_up'})},</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">    {"&amp;M WiMax",   env.rfkill.wimax   , freedesktop_utils.lookup_icon({icon = 'stock_up'})},</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">    {"&amp;N None",   env.rfkill.off   , freedesktop_utils.lookup_icon({icon = 'stock_down'})},</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">}, freedesktop_utils.lookup_icon({icon = 'wicd-gtk'})},</span>
        { <span style="color: #ffff00;">"&amp;X Xkill"</span>, xkill, freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">"weather-storm"</span>}) },
        { <span style="color: #ffff00;">"&amp;R Run"</span>, run, freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">"access"</span>}) },
        { <span style="color: #ffff00;">""</span>, <span style="color: #00ffff;">nil</span>, <span style="color: #00ffff;">nil</span>}, <span style="color: #ff0000;">--separator</span>
        { <span style="color: #ffff00;">"&amp;P Power"</span>, myquitmenu, freedesktop_utils.lookup_icon({ icon = <span style="color: #ffff00;">'gnome-logout'</span> }) },
    }

    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">mymainmenu_items</span> = {}
    <span style="color: #00ffff;">for</span> _, item <span style="color: #00ffff;">in</span> ipairs(mymainmenu_items_head) <span style="color: #00ffff;">do</span> table.insert(mymainmenu_items, item) <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">for</span> _, item <span style="color: #00ffff;">in</span> ipairs(freedesktop_menu.new()) <span style="color: #00ffff;">do</span> table.insert(mymainmenu_items, item) <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">for</span> _, item <span style="color: #00ffff;">in</span> ipairs(mymainmenu_items_tail) <span style="color: #00ffff;">do</span> table.insert(mymainmenu_items, item) <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">return</span> awful.menu({ items = mymainmenu_items, x = 0, y = 0})
<span style="color: #00ffff;">end</span>
</pre>


</div>

</div>

<div id="outline-container-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> tagman.lua</h3>
<div class="outline-text-3" id="text-4-2">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Author: Sergey Mironov ierton@gmail.com</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">License: BSD3</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">2009-2010</span>
<span style="color: #ff0000;">--</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Tag manipulation library</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Note: library uses signal "tagman::update"</span>

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awful</span> = require(<span style="color: #ffff00;">"awful"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">beautiful</span> = require(<span style="color: #ffff00;">"beautiful"</span>)

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">capi</span> = {
        io = io,
        screen = screen,
        tag = tag,
        mouse = mouse,
        client = client,
    awesome = awesome
}

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">client</span> = client
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">type</span> = type
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">table</span> = table
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awesome</span> = awesome
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">ipairs</span> = ipairs
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">pairs</span> = pairs
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tostring</span> = tostring

module(<span style="color: #ffff00;">"myrc.tagman"</span>)

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Returns tag by name</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">find</span>(name,s)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">s</span> = s <span style="color: #00ffff;">or</span> client.focus <span style="color: #00ffff;">and</span> client.focus.screen <span style="color: #00ffff;">or</span> capi.mouse.screen
        <span style="color: #00ffff;">for</span> _,t <span style="color: #00ffff;">in</span> ipairs(capi.screen[s]:tags()) <span style="color: #00ffff;">do</span> 
        <span style="color: #00ffff;">if</span> name == t.name <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> t <span style="color: #00ffff;">end</span> 
    <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">nil</span>
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Returns list of tag names at screen @s</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">names</span>(s)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">s</span> = s <span style="color: #00ffff;">or</span> client.focus <span style="color: #00ffff;">and</span> client.focus.screen <span style="color: #00ffff;">or</span> capi.mouse.screen
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">result</span> = {}
        <span style="color: #00ffff;">for</span> _,t <span style="color: #00ffff;">in</span> ipairs(capi.screen[s]:tags()) <span style="color: #00ffff;">do</span> 
        table.insert(result, t.name) 
    <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">return</span> result
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Returns tag by index @index, starting from 0.</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get</span>(index, s)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">s</span> = s <span style="color: #00ffff;">or</span> client.focus <span style="color: #00ffff;">and</span> client.focus.screen <span style="color: #00ffff;">or</span> capi.mouse.screen
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">stags</span> = capi.screen[s]:tags()
    <span style="color: #00ffff;">return</span> stags[awful.util.cycle(#stags, index)]
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Returns index of current tag (on this screen)</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">indexof</span>(tag)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">all_tags</span> = capi.screen[tag.screen]:tags()
        <span style="color: #00ffff;">return</span> awful.util.table.hasitem(all_tags,tag)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">next_to</span>(t,n) <span style="color: #00ffff;">return</span> get(indexof(t)+(n <span style="color: #00ffff;">or</span> 1),s) <span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">prev_to</span>(t,n) <span style="color: #00ffff;">return</span> get(indexof(t)-(n <span style="color: #00ffff;">or</span> 1),s) <span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Gets tag object, by its offset @offset, starting from </span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">tag @basetag</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">getn</span>(offset, basetag, s)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">offset</span> = offset <span style="color: #00ffff;">or</span> 0
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">s</span> = s <span style="color: #00ffff;">or</span> client.focus <span style="color: #00ffff;">and</span> client.focus.screen <span style="color: #00ffff;">or</span> capi.mouse.screen
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">stags</span> = capi.screen[s]:tags()
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">basetag</span> = basetag <span style="color: #00ffff;">or</span> awful.tag.selected()
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">k</span> = awful.util.table.hasitem(stags,basetag)
    <span style="color: #00ffff;">return</span> stags[awful.util.cycle(#stags, k + offset)]
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Moves all tagless clients of screen @s to tag @deftag</span>
<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">handle_orphans</span>(s, deftag)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">s</span> = s <span style="color: #00ffff;">or</span> client.focus <span style="color: #00ffff;">and</span> client.focus.screen <span style="color: #00ffff;">or</span> capi.mouse.screen
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">stags</span> = capi.screen[s]:tags()
        <span style="color: #00ffff;">if</span> #stags &lt; 1 <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">deftag</span> = deftag <span style="color: #00ffff;">or</span> stags[1]
    <span style="color: #00ffff;">for</span> _, c <span style="color: #00ffff;">in</span> pairs(client.get(s)) <span style="color: #00ffff;">do</span>
        <span style="color: #00ffff;">if</span> #c:tags() == 0 <span style="color: #00ffff;">then</span>
            c:tags({deftag})
        <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Does what?</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">sort</span>(s, fn)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">fn</span> = fn <span style="color: #00ffff;">or</span> <span style="color: #00ffff;">function</span> (a, b) <span style="color: #00ffff;">return</span> a.name &lt; b.name <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">s</span> = s <span style="color: #00ffff;">or</span> client.focus <span style="color: #00ffff;">and</span> client.focus.screen <span style="color: #00ffff;">or</span> capi.mouse.screen
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">all_tags</span> = capi.screen[s]:tags()
    table.sort(all_tags, fn)
    capi.screen[s]:tags(all_tags)
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Moves tag to position @where (if where is number) -OR- next</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">to tag @where (if @where is object)</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">In latter case @where should be on the @tag's screen</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">move</span>(tag, where)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">stags</span> = capi.screen[tag.screen]:tags()
    <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Current possition of the tag</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">oldkey</span> = indexof(tag)
    <span style="color: #00ffff;">if</span> oldkey == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">end</span>
    <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">New position of the tag</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">newkey</span> = <span style="color: #00ffff;">nil</span>
        <span style="color: #00ffff;">if</span> type(where) == <span style="color: #ffff00;">"number"</span> <span style="color: #00ffff;">then</span>
                newkey = awful.util.cycle(#stags, where)
        <span style="color: #00ffff;">else</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">dest tag should be on the same screen with src</span>
        <span style="color: #00ffff;">if</span> where.screen ~= tag.screen <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">end</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">expect a table (a tag)</span>
                newkey = indexof(where)
        <span style="color: #00ffff;">end</span>

        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">c</span> = capi.client.focus

    table.remove(stags,oldkey)
    table.insert(stags,newkey,tag)
    capi.screen[tag.screen]:tags(stags)

        awesome.emit_signal(<span style="color: #ffff00;">"tagman::update"</span>, tag, tag.screen)
    <span style="color: #00ffff;">if</span> c~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span> 
        capi.client.focus = c 
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Adds a tag named @tn with props @props</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">NOTE: those properties are not the same with awful.tag's</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">add</span>(tn, props, s)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">props</span> = props <span style="color: #00ffff;">or</span> {}
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">s</span> = s <span style="color: #00ffff;">or</span> client.focus <span style="color: #00ffff;">and</span> client.focus.screen <span style="color: #00ffff;">or</span> capi.mouse.screen
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tname</span> = tostring(tn)
    <span style="color: #00ffff;">if</span> tname == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">t</span> = awful.tag.add(tname)
        t.screen = s
        awful.layout.set(props.layout <span style="color: #00ffff;">or</span> awful.layout.suit.max, t)
        <span style="color: #00ffff;">if</span> props.setsel == <span style="color: #00ffff;">true</span> <span style="color: #00ffff;">then</span> t.selected = <span style="color: #00ffff;">true</span> <span style="color: #00ffff;">end</span>
        awesome.emit_signal(<span style="color: #ffff00;">"tagman::update"</span>, t, s)
        <span style="color: #00ffff;">return</span> t
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Removes tag @t. Move it's clients to tag @deft</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">del</span>(tag, deft)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">s</span> = tag.screen
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">stags</span> = capi.screen[s]:tags()
    <span style="color: #00ffff;">if</span> #stags &lt;= 1 <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">deft</span> = deft <span style="color: #00ffff;">or</span> prev_to(tag)
    <span style="color: #00ffff;">if</span> deft == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span> <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">end</span>
    tag.screen = <span style="color: #00ffff;">nil</span>
    awesome.emit_signal(<span style="color: #ffff00;">"tagman::update"</span>, tag, s)
    handle_orphans(s, deft)
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Renames tag @tag with name @newname</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">rename</span>(tag, newname)
        tag.name = newname
        awesome.emit_signal(<span style="color: #ffff00;">"tagman::update"</span>, tag, tag.screen)
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Initializes the library. </span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Creates a se of tags for each screen</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@name_getter is a function taking screen index and returning </span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">a list of tag names.</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">init</span>(name_getter)
        <span style="color: #00ffff;">for</span> s = 1, capi.screen.count() <span style="color: #00ffff;">do</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">namelist</span> = name_getter(s)
        <span style="color: #00ffff;">if</span> namelist == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">or</span> #namelist == 0 <span style="color: #00ffff;">then</span>
            namelist = {}
            <span style="color: #00ffff;">for</span> i=1,9 <span style="color: #00ffff;">do</span> namelist[i] = tostring(i) <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">end</span>
                <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Each screen has its own tag table.</span>
                <span style="color: #00ffff;">for</span> i, name <span style="color: #00ffff;">in</span> ipairs(namelist) <span style="color: #00ffff;">do</span> 
                        add(name, { setsel=(i==1) }, s) 
                <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>
</pre>

</div>

</div>

<div id="outline-container-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> keybind.lua</h3>
<div class="outline-text-3" id="text-4-3">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Author: Sergey Mironov ierton@gmail.com</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">License: BSD3</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">2009-2010</span>
<span style="color: #ff0000;">--</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Library allows user to bind GNU Screen style 'chords'</span>

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awful</span> = require(<span style="color: #ffff00;">"awful"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">naughty</span> = require(<span style="color: #ffff00;">"naughty"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">mouse</span> = mouse

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">capi</span> = {
        root = root,
}

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">table</span> = table
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">ipairs</span> = ipairs
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tostring</span> = tostring

module(<span style="color: #ffff00;">"myrc.keybind"</span>)


<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">active</span> = <span style="color: #00ffff;">nil</span>

<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">get_keys</span>(c)
    <span style="color: #00ffff;">if</span> c == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
        <span style="color: #00ffff;">return</span> capi.root.keys()
    <span style="color: #00ffff;">else</span>
        <span style="color: #00ffff;">return</span> c:keys()
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">set_keys</span>(c, k)
    <span style="color: #00ffff;">if</span> c == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
        capi.root.keys(k)
    <span style="color: #00ffff;">else</span>
        c:keys(k)
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">dbg</span>(m)
    naughty.notify({
        title = <span style="color: #ffff00;">"[Warning]"</span>,
        text = m,
        timeout = 10,
        position = <span style="color: #ffff00;">"bottom_left"</span>,
    })
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">remove_a_key</span>(k, tbl)
    <span style="color: #00ffff;">for</span> pos,x <span style="color: #00ffff;">in</span> ipairs(tbl) <span style="color: #00ffff;">do</span>
        <span style="color: #00ffff;">if</span> x.key == k.key <span style="color: #00ffff;">and</span> #x.modifiers == #k.modifiers <span style="color: #00ffff;">then</span>
            <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">match</span> = <span style="color: #00ffff;">true</span>
            <span style="color: #00ffff;">for</span> i=1, #x.modifiers <span style="color: #00ffff;">do</span>
                <span style="color: #00ffff;">if</span> x.modifiers[i] ~= k.modifiers[i] <span style="color: #00ffff;">then</span>
                    match = <span style="color: #00ffff;">false</span>
                    <span style="color: #00ffff;">break</span>
                <span style="color: #00ffff;">end</span>
            <span style="color: #00ffff;">end</span>
            <span style="color: #00ffff;">if</span> match <span style="color: #00ffff;">then</span>
                table.remove(tbl,pos)
                <span style="color: #00ffff;">return</span>
            <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">end</span>

    dbg(<span style="color: #ffff00;">"Can't find a key: "</span> .. k.keysym)
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">chord_release</span>(ch)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">allkeys</span> = get_keys(ch.client)
    <span style="color: #00ffff;">for</span> _,kt <span style="color: #00ffff;">in</span> ipairs(ch.keytable) <span style="color: #00ffff;">do</span>
        <span style="color: #00ffff;">for</span> _,k <span style="color: #00ffff;">in</span> ipairs(kt.keys) <span style="color: #00ffff;">do</span>
            remove_a_key(k,allkeys)
        <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">end</span>

    set_keys(ch.client, allkeys)

    <span style="color: #00ffff;">if</span> ch.menu <span style="color: #00ffff;">then</span>
        awful.menu.hide(ch.menu)
        ch.menu = <span style="color: #00ffff;">nil</span>
    <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">if</span> ch.naughtybox <span style="color: #00ffff;">then</span>
        naughty.destroy(ch.naughtybox)
        ch.naughtybox = <span style="color: #00ffff;">nil</span>
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Cancels current chord, if any</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">pop</span>()
    <span style="color: #00ffff;">if</span> active ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
        chord_release(active)
        active = <span style="color: #00ffff;">nil</span>
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">mod</span>(k) <span style="color: #00ffff;">return</span> k[1] <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">keysym</span>(k) <span style="color: #00ffff;">return</span> k[2] <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">desc</span>(k) <span style="color: #00ffff;">return</span> k[3] <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"&lt;no description&gt;"</span> <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">press</span>(k) <span style="color: #00ffff;">return</span> k[4] <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">icon</span>(k) <span style="color: #00ffff;">return</span> k[5] <span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">chord_new</span>(keytable, c)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">newkeys</span> = <span style="color: #00ffff;">nil</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">chord</span> = {}
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">old</span> = {}
    <span style="color: #00ffff;">for</span> _, k <span style="color: #00ffff;">in</span> ipairs(keytable) <span style="color: #00ffff;">do</span>
        <span style="color: #00ffff;">if</span> #k &lt; 3 <span style="color: #00ffff;">then</span>
            dbg(<span style="color: #ffff00;">"Invalid chord key detected after:"</span> .. keysym(old))
        <span style="color: #00ffff;">end</span>
        k.keys = awful.key(mod(k), keysym(k), <span style="color: #00ffff;">function</span>()
            <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">finish</span> = press(k)()
            <span style="color: #00ffff;">if</span> finish ~= <span style="color: #00ffff;">false</span> <span style="color: #00ffff;">then</span> pop() <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">end</span>)
        newkeys = awful.util.table.join(newkeys, k.keys)
        old = k
    <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">allkeys</span> = get_keys(c)
    <span style="color: #00ffff;">for</span> _,k <span style="color: #00ffff;">in</span> ipairs(newkeys) <span style="color: #00ffff;">do</span>
        table.insert(allkeys, k)
    <span style="color: #00ffff;">end</span>
    set_keys(c, allkeys)

    chord.client = c
    chord.keytable = keytable
    <span style="color: #00ffff;">return</span> chord
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Constructs menu describing chord table given</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">chord_menu</span>(keytable)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">template</span> = keytable.menu <span style="color: #00ffff;">or</span> {}
    template.items = {}

    <span style="color: #00ffff;">for</span> _, k <span style="color: #00ffff;">in</span> ipairs(keytable) <span style="color: #00ffff;">do</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">item</span> = {
            tostring(keysym(k)) .. <span style="color: #ffff00;">": "</span> .. desc(k), 
            press(k),
            icon(k)
        }
        table.insert(template.items, item)
    <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">return</span> awful.menu.new(template)
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Constructs naughty box describing chord table given</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">chord_naughty</span>(keytable)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">template</span> = keytable.naughty <span style="color: #00ffff;">or</span> {}

    template.text = <span style="color: #ffff00;">""</span>
    <span style="color: #00ffff;">for</span> _, k <span style="color: #00ffff;">in</span> ipairs(keytable) <span style="color: #00ffff;">do</span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">TODO: Take modifiers into account when </span>
        <span style="color: #ff0000;">-- </span><span style="color: #ff0000;">generating descriptions</span>
        template.text = template.text ..
        <span style="color: #ffff00;">"\n"</span> .. tostring(k.keysym) ..
        <span style="color: #ffff00;">": "</span> ..  ( k.desc <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"&lt;no_description&gt;"</span> )
    <span style="color: #00ffff;">end</span>

    <span style="color: #00ffff;">return</span> naughty.notify(template)
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Function inserts keys from table 'keytable'</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">into client's keys(). Then it pops naughtybox </span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">showing chord description.</span>
<span style="color: #ff0000;">--</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@param keytable Keys to be mapped</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@param c Client. if nil, global keys will be used.</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">push</span>(keytable, c)
    pop()
    active = chord_new(keytable, c)
    <span style="color: #00ffff;">return</span> active
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">push_menu</span>(keytable, args, c)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">chord</span> = push(keytable, c)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">menu</span> = chord_menu(keytable)
    <span style="color: #4186be;">menu.hide</span> = <span style="color: #00ffff;">function</span>(m)
        awful.menu.hide(m)
        pop()
    <span style="color: #00ffff;">end</span>
    chord.menu = menu
    chord.menu:show(args)
    <span style="color: #00ffff;">return</span> chord
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">push_naughty</span>(keytable, c)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">chord</span> = push(keytable, c)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">nb</span> = chord_naughty(keytable)
    chord.naughtybox = nb
    <span style="color: #00ffff;">return</span> chord
<span style="color: #00ffff;">end</span>
</pre>


</div>

</div>

<div id="outline-container-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> logmon.lua</h3>
<div class="outline-text-3" id="text-4-4">




<pre class="src src-lua"><span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awful</span> = require(<span style="color: #ffff00;">"awful"</span>)

module(<span style="color: #ffff00;">"myrc.logmon"</span>)

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">init</span>()
        awful.util.spawn(awful.util.getdir(<span style="color: #ffff00;">"config"</span>)..<span style="color: #ffff00;">"/lognotifier"</span>, <span style="color: #00ffff;">false</span>)
<span style="color: #00ffff;">end</span>
</pre>

</div>

</div>

<div id="outline-container-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="section-number-3">4.5</span> memory.lua</h3>
<div class="outline-text-3" id="text-4-5">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Author: Sergey Mironov ierton@gmail.com</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">License: BSD3</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">2009-2010</span>
<span style="color: #ff0000;">--</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Registry support</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Note: library requires table.save lua lib</span>

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awful</span> = require(<span style="color: #ffff00;">"awful"</span>)

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">io</span> = io
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">table</span> = table
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awesome</span> = awesome
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">ipairs</span> = ipairs
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tostring</span> = tostring
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">type</span> = type
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">string</span> = string

module(<span style="color: #ffff00;">"myrc.memory"</span>)

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">tables</span> = {}
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">current_version</span> = 1

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">init</span>()
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">config</span> = awful.util.getdir(<span style="color: #ffff00;">"config"</span>)..<span style="color: #ffff00;">"/memory.data"</span>
        tables, err = table.load(config)
        <span style="color: #00ffff;">if</span> err ~= <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
                tables = {}
        <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">if</span> tables.verion == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
                tables.verion = current_version
        <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">set</span>(t, key, value)
        <span style="color: #00ffff;">if</span> type(tables[t]) == <span style="color: #ffff00;">"nil"</span> <span style="color: #00ffff;">then</span>
                tables[t] = {}
        <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">oldvalue</span> = tables[t] [key]
        tables[t] [key] = value
        <span style="color: #00ffff;">if</span> oldvalue ~= value <span style="color: #00ffff;">then</span>
                <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">config</span> = awful.util.getdir(<span style="color: #ffff00;">"config"</span>)..<span style="color: #ffff00;">"/memory.data"</span>
                <span style="color: #00ffff;">local</span> res, err = table.save(tables, config)
        <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">return</span> value
<span style="color: #00ffff;">end</span>

<span style="color: #00ffff;">function</span> <span style="color: #4186be;">get</span>(table, key, defvalue)

        <span style="color: #00ffff;">if</span> type(tables[table]) == <span style="color: #ffff00;">"nil"</span> <span style="color: #00ffff;">then</span>
                <span style="color: #00ffff;">return</span> defvalue
        <span style="color: #00ffff;">elseif</span> type(tables[table][key]) == <span style="color: #ffff00;">"nil"</span> <span style="color: #00ffff;">then</span>
                <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">oldkey</span> = string.gsub(key,<span style="color: #ffff00;">"([^:]*:[^:]*:[^:]*):[^:]*"</span>, <span style="color: #ffff00;">"%1"</span>)
                <span style="color: #00ffff;">if</span> type(tables[table][oldkey]) == <span style="color: #ffff00;">"nil"</span> <span style="color: #00ffff;">then</span>
                        <span style="color: #00ffff;">return</span> defvalue
                <span style="color: #00ffff;">end</span>
                <span style="color: #00ffff;">return</span> tables[table][oldkey]
        <span style="color: #00ffff;">end</span>

        <span style="color: #00ffff;">return</span> tables[table][key]
<span style="color: #00ffff;">end</span>
</pre>

</div>

</div>

<div id="outline-container-4-6" class="outline-3">
<h3 id="sec-4-6"><span class="section-number-3">4.6</span> themes.lua</h3>
<div class="outline-text-3" id="text-4-6">




<pre class="src src-lua"><span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Author: Sergey Mironov ierton@gmail.com</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">License: BSD3</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">2009-2010</span>
<span style="color: #ff0000;">--</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Library manages current theme symlink</span>

<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awful</span> = require(<span style="color: #ffff00;">"awful"</span>)
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">io</span> = io
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">table</span> = table
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">awesome</span> = awesome
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">os</span> = os
<span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">string</span> = string

module(<span style="color: #ffff00;">"myrc.themes"</span>)


<span style="color: #00ffff;">local function</span> <span style="color: #4186be;">hasfile</span>(f)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">exists</span> = io.open(f)
    <span style="color: #00ffff;">if</span> exists <span style="color: #00ffff;">then</span>
        io.close(exists)
        <span style="color: #00ffff;">return</span> f
    <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">nil</span>
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">List your theme files and feed menu table</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Item handlers will create .current symlink </span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">to point to theme selected</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">menu</span>(args)
    args = args <span style="color: #00ffff;">or</span> {}
    args.default_icon = args.default_icon <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"/usr/local/share/awesome/icons/awesome16.png"</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">mythememenu</span> = {}
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">cfgpath</span> = awful.util.getdir(<span style="color: #ffff00;">"config"</span>)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">themespath</span> = cfgpath .. <span style="color: #ffff00;">"/themes"</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">cmd</span> = <span style="color: #ffff00;">"find -L "</span> .. themespath .. <span style="color: #ffff00;">" -name 'theme.lua' -and -not -path '*.current*'"</span>
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">f</span> = io.popen(cmd)
        <span style="color: #00ffff;">for</span> l <span style="color: #00ffff;">in</span> f:lines() <span style="color: #00ffff;">do</span>
                <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">folder</span> = string.gsub(l,<span style="color: #ffff00;">"[%w/._-]+/([%w-_]+)/theme.lua"</span>, <span style="color: #ffff00;">"%1"</span>)
        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">icon</span> = 
            hasfile(themespath .. <span style="color: #ffff00;">"/"</span> .. folder .. <span style="color: #ffff00;">"/awesome-icon.png"</span>) <span style="color: #00ffff;">or</span>
            hasfile(args.default_icon)
                <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">item</span> = { folder, <span style="color: #00ffff;">function</span> () 
                        <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">themepath</span> = string.gsub(l,<span style="color: #ffff00;">"(%w+)/theme.lua"</span>, <span style="color: #ffff00;">"%1"</span>)
                        awful.util.pread(<span style="color: #ffff00;">"rm -f "</span> .. themespath .. <span style="color: #ffff00;">"/.current"</span>)
                        awful.util.pread(<span style="color: #ffff00;">"ln -s "</span> .. folder .. <span style="color: #ffff00;">" "</span> .. themespath .. <span style="color: #ffff00;">"/.current"</span>)
                        awesome.restart()
                <span style="color: #00ffff;">end</span>, icon }
                table.insert(mythememenu, item)
        <span style="color: #00ffff;">end</span>

        f:close()
        <span style="color: #00ffff;">return</span> mythememenu
<span style="color: #00ffff;">end</span>

<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">Returns current theme.</span>
<span style="color: #ff0000;">-- </span><span style="color: #ff0000;">@param default Default theme name</span>
<span style="color: #00ffff;">function</span> <span style="color: #4186be;">current</span>(default)
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">default</span> = default <span style="color: #00ffff;">or</span> <span style="color: #ffff00;">"blue-black-red"</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">filename</span> = awful.util.getdir(<span style="color: #ffff00;">"config"</span>) .. <span style="color: #ffff00;">"/themes/.current/theme.lua"</span>
    <span style="color: #00ffff;">local</span> <span style="color: #ffffff; font-weight: bold;">handle</span> = io.open(filename)
    <span style="color: #00ffff;">if</span> handle == <span style="color: #00ffff;">nil</span> <span style="color: #00ffff;">then</span>
        <span style="color: #00ffff;">return</span> awful.util.getdir(<span style="color: #ffff00;">"config"</span>) .. <span style="color: #ffff00;">"/themes/"</span> .. default .. <span style="color: #ffff00;">"/theme.lua"</span>
    <span style="color: #00ffff;">else</span>
        io.close(handle)
        <span style="color: #00ffff;">return</span> filename
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>
</pre>


</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> pipelets</h2>
<div class="outline-text-2" id="text-5">


</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> temp</h3>
<div class="outline-text-3" id="text-5-1">




<pre class="src src-sh"><span style="color: #ff0000;">## </span><span style="color: #ff0000;">trap "pkill -P $$" SIGINT</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">trap "pkill -P $$" EXIT</span>

<span style="color: #ff0000;"># </span><span style="color: #ff0000;">while true ; do</span>
<span style="color: #ff0000;">#     </span><span style="color: #ff0000;">temp3=`sensors | grep 'temp3' | awk '{print $2}'`</span>
<span style="color: #ff0000;">#     </span><span style="color: #ff0000;">core0=`sensors | grep 'Core 0' | awk '{print $3}'`</span>
<span style="color: #ff0000;">#     </span><span style="color: #ff0000;">echo -n "Core 0: " $core0 " | temp3 :" $temp3</span>
<span style="color: #ff0000;">#     </span><span style="color: #ff0000;">sleep 60</span>
<span style="color: #ff0000;"># </span><span style="color: #ff0000;">done</span>

<span style="color: #00ffff;">while</span> true ; <span style="color: #00ffff;">do</span>
    <span style="color: #ffaa00;">echo</span> -n <span style="color: #ffff00;">"temp3: "</span>
    sensors | grep <span style="color: #ffff00;">'temp3'</span> | awk <span style="color: #ffff00;">'{print $2}'</span>
    sleep 60
<span style="color: #00ffff;">done</span>
</pre>

</div>

</div>

<div id="outline-container-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> batmon</h3>
<div class="outline-text-3" id="text-5-2">




<pre class="src src-sh"><span style="color: #ff0000;">#</span><span style="color: #ff0000;">!/bin/</span><span style="color: #00ffff;">sh</span>

which acpitool &gt;/dev/null || <span style="color: #00ffff;">exit</span> 1
which acpi_listen &gt;/dev/null || <span style="color: #00ffff;">exit</span> 1

<span style="color: #00ffff;">while</span> true ; <span style="color: #00ffff;">do</span>
    <span style="color: #ff0000;"># </span><span style="color: #ff0000;">Lookup first battery's status</span>
    <span style="color: #ffffff; font-weight: bold;">line</span>=<span style="color: #fa8072;">`acpitool -b | head -n 1`</span>
    <span style="color: #ffffff; font-weight: bold;">batnum</span>=<span style="color: #fa8072;">`echo "$line" |  sed 's/.*#\(.\).*/\1/'`</span>
    <span style="color: #ffffff; font-weight: bold;">percent</span>=<span style="color: #fa8072;">`echo "$line" | sed 's/.*\:[^,]*, \([^,]*\).*/\1/'`</span>
    <span style="color: #00ffff;">if </span><span style="color: #ffaa00;">echo</span> <span style="color: #ffff00;">"$line"</span> | grep -q discharging ; <span style="color: #00ffff;">then</span>
        <span style="color: #ffffff; font-weight: bold;">color</span>=<span style="color: #ffff00;">'#662222'</span>
        <span style="color: #ffffff; font-weight: bold;">tleft</span>=<span style="color: #fa8072;">`echo "$line" | sed 's/.*\:[^,]*, [^,]*, \(..:..\).*/\1/'`</span>
    <span style="color: #00ffff;">else</span>
        <span style="color: #ffffff; font-weight: bold;">color</span>=<span style="color: #ffff00;">'#226622'</span>
        <span style="color: #ffffff; font-weight: bold;">tleft</span>=<span style="color: #ffff00;">''</span>
    <span style="color: #00ffff;">fi</span>

    <span style="color: #ffaa00;">echo</span> <span style="color: #ffff00;">"&lt;span color='$color'&gt;BAT#$batnum $percent $tleft&lt;/span&gt;"</span>

    <span style="color: #ff0000;"># </span><span style="color: #ff0000;">Exits after -c X ACPI events or after -t Y sec elapsed</span>
    acpi_listen -t 60 -c 1 &gt;/dev/null 2&gt;&amp;1
    sleep 2
<span style="color: #00ffff;">done</span>
</pre>

</div>

</div>

<div id="outline-container-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> date</h3>
<div class="outline-text-3" id="text-5-3">




<pre class="src src-sh"><span style="color: #ff0000;">#</span><span style="color: #ff0000;">!/bin/</span><span style="color: #00ffff;">sh</span>
<span style="color: #ffaa00;">export</span> <span style="color: #ffffff; font-weight: bold;">LANG</span>=ru_RU.utf-8 
<span style="color: #00ffff;">while</span> true ; <span style="color: #00ffff;">do</span>
        date +<span style="color: #ffff00;">'%a %d %b, %H:%M'</span>
        sleep 60
<span style="color: #00ffff;">done</span>
</pre>

</div>

</div>

<div id="outline-container-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> mmount</h3>
<div class="outline-text-3" id="text-5-4">




<pre class="src src-sh"><span style="color: #ff0000;">#</span><span style="color: #ff0000;">!/bin/</span><span style="color: #00ffff;">sh</span>

<span style="color: #ff0000;">## </span><span style="color: #ff0000;">trap "pkill -P $$" SIGINT</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">trap "pkill -P $$" EXIT</span>

<span style="color: #ffffff; font-weight: bold;">INOWAIT</span>=/usr/bin/inotifywait

<span style="color: #4186be;">parse</span>() {
    cat /proc/mounts | 
    awk <span style="color: #ffff00;">'{print $2}'</span> | 
    grep -v -E <span style="color: #ffff00;">'/proc|/dev|/bus|/sys|/lib|/run'</span> | 
    grep -w -v /
}

<span style="color: #00ffff;">while</span> true ; <span style="color: #00ffff;">do</span>
    <span style="color: #00ffff;">for</span> m<span style="color: #00ffff;"> in</span> <span style="color: #fa8072;">`parse`</span> ; <span style="color: #00ffff;">do</span>
        printf <span style="color: #ffff00;">"[%s] "</span> <span style="color: #fa8072;">`basename $m`</span>
    <span style="color: #00ffff;">done</span>
    <span style="color: #ffaa00;">echo</span>

    <span style="color: #00ffff;">if</span> [ -e $<span style="color: #ffffff; font-weight: bold;">INOWAIT</span> ] ; <span style="color: #00ffff;">then</span>
        $<span style="color: #ffffff; font-weight: bold;">INOWAIT</span> /etc/mtab &gt;/dev/null 2&gt;&amp;1
        sleep 0.2
    <span style="color: #ff0000;">## </span><span style="color: #ff0000;">else</span>
        sleep 20
    <span style="color: #00ffff;">fi</span>
<span style="color: #00ffff;">done</span>
</pre>

</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Autostart</h2>
<div class="outline-text-2" id="text-6">




<pre class="src src-sh"><span style="color: #ff0000;">#</span><span style="color: #ff0000;">!/bin/</span><span style="color: #00ffff;">bash</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">~/bin/adjustMonitor</span>

<span style="color: #ff0000;">## </span><span style="color: #ff0000;">Just to make sure, source .bash_profile and .bashrc</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">source ~/.bash_profile &amp;</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">source ~/.bashrc &amp;</span>

<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">set caps lock as compose key</span>
setxkbmap -option compose:caps &amp;
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">disable touchpad when typing</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">syndaemon -d -i 2 &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">autostart using Freedesktop specifications </span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">fbautostart &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start gnome keyring</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">/usr/bin/gnome-keyring-daemon --start --components=ssh</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start conky</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">conky -c /home/rkrug/.conky/conkyrc &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start gnome volume control</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">gnome-volume-control-applet &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start network applett</span>
<span style="color: #ff0000;"># </span><span style="color: #ff0000;">wicd-gtk &amp;</span>
run_once nm-applet &amp;
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start gnome power manager</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">gnome-power-manager &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start gnome-do</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">gnome-do &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start bluetooth-applets</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">bluetooth-applet &amp;</span>
run_once blueman-applet &amp;
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start ejecter</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">ejecter &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start spideroak</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">run_once SpiderOak &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start screenlets</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">screenlets-daemon &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start workrave</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">workrave &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start tasque for management of RTM</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">tasque &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start udisks-glue to enable automount</span>
run_once udisks-glue &amp; 
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start avant window manager</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">avant-window-navigator &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start skype</span>
run_once skype.video &amp;
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start qwit twitter client</span>
<span style="color: #ff0000;"># </span><span style="color: #ff0000;">qwit &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start radiotray webradio player</span>
run_once radiotray &amp;
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start mail-notification</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">mail-notification &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">set background</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">fbsetbg -a -u feh -r ~/Pictures/Katharina/2010 &amp;</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">nitrogen --restore &amp;</span>
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start guake</span>
run_once guake &amp; 
<span style="color: #ff0000;">###################</span>
<span style="color: #ff0000;">## </span><span style="color: #ff0000;">start recollindex usin ionice Idle</span>
 <span style="color: #ff0000;"># </span><span style="color: #ff0000;">ionice -c 3 recollindex -m &amp;</span>
<span style="color: #ff0000;">###################</span>

</pre>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2012-05-11 Fri</p>
<p class="author">Author: Rainer M. Krug</p>
<p class="creator">Org version 7.8.09 with Emacs version 23</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
